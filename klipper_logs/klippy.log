===== Config file =====
[pause_resume]

[display_status]

[gcode_macro START_PRINT]
gcode = 
	CLEAR_PAUSE
	M117 Print Starting...
	M104 S{T_EXTRUDER}
	M140 S{T_BED}
	{% if printer.heater_bed.temperature < params.T_BED|float*0.95 %}
	M190 S{params.T_BED|float*0.95}
	{% endif %}
	M117 Homing All...
	G28
	G92 E0 ; Reset Extruder distance to 0
	G1 E-2 ; Retracts filament to prevent blobs during probing
	Z_TILT_ADJUST
	LEVEL_BED
	G90
	G92 E0
	SET_GCODE_OFFSET Z=0
	G1 X15 Y20 Z5 F6000
	M117 Waiting for Temps
	M190 S{T_BED}
	M109 S{T_EXTRUDER}
	PRIME_LINE
	M117 Printing.....

[gcode_macro END_PRINT]
gcode = 
	SAVE_GCODE_STATE NAME=end_print
	M117 Done printing
	G91
	G1 E-10 F3600
	G90
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < 100 %}
	{% set z_safe = 100.0 %}
	{% else %}
	{% set z_safe = 0 %}
	{% endif %}
	{% set x_max = printer.toolhead.axis_maximum.x|float - 3 %}
	{% set y_max = printer.toolhead.axis_maximum.y|float - 3 %}
	G1 X{x_max} Y{y_max} Z{z_safe} F2000
	M104 S0         ;Disable Hot End
	M140 S0         ;Disable Heat Bed
	RESTORE_GCODE_STATE NAME=end_print
	M84             ;Disable Steppers
	BED_MESH_CLEAR

[gcode_macro PRIME_LINE]
gcode = 
	M117 Prime Line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up
	G1 X0 Y30 Z2.28 F5000 ;Move to start position
	G1 X0 Y200.0 Z2.28 F500 E15 ;Draw the first line
	G1 X1 Y200.0 Z2.28 F5000 ;Move to side a little
	G1 X1 Y50 Z2.28 F500 E30 ;Draw the second line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up

[gcode_macro G29]
gcode = 
	G28
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE save=default

[gcode_macro LEVEL_BED]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro M204]
rename_existing = M204.1
default_parameter_f = 0.75
gcode = 
	{% if 'S' in params %}
	SET_VELOCITY_LIMIT ACCEL={ S } ACCEL_TO_DECEL={ S|float * F|float }
	{% endif %}
	{% if 'P' in params %}
	SET_VELOCITY_LIMIT ACCEL={ P } ACCEL_TO_DECEL={ P|float * F|float }
	{% endif %}

[gcode_macro M205]
gcode = 
	{% if 'X' in params %}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={ X }
	{% endif %}

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% if printer.extruder.target != 0 %}
	{% if printer.extruder.temperature < printer.extruder.target %}
	M117 Heating from {printer.extruder.temperature} to {printer.extruder.target}.
	M109 S{printer.extruder.target|float}
	{% endif %}
	{% else %}
	{% if printer.extruder.target < T %}
	M117 No setpoint, heating to {T}.
	M109 S{T}
	{% endif %}
	{% endif %}

[gcode_macro M600]
gcode = 
	PAUSE_MACRO
	UNLOAD

[gcode_macro M601]
gcode = 
	PAUSE_MACRO

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro PAUSE_MACRO]
gcode = 
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=bed_temp VALUE={printer.heater_bed.target}
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=extruder_temp VALUE={printer.extruder.target}
	M117 Parking...
	PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=28800
variable_bed_temp = 0
variable_extruder_temp = 0

[gcode_macro RESUME_MACRO]
gcode = 
	M117 Heating Back Up...
	M140 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M104 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	M190 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M109 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	SET_IDLE_TIMEOUT TIMEOUT=600
	M117  Resuming...
	RESUME

[gcode_macro LOAD]
gcode = 
	SAVE_GCODE_STATE NAME=loading_filament
	M83
	G92 E0.0
	G1 E10 F1000
	G1 E100 F200
	G92 E0.0
	RESTORE_GCODE_STATE NAME=loading_filament

[gcode_macro UNLOAD]
gcode = 
	SAVE_GCODE_STATE NAME=unloading_filament
	G91
	G1 E10 F100
	G92 E0.0
	G1 E-150 F1000
	G92 E0.0
	RESTORE_GCODE_STATE NAME=unloading_filament

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro TIMELAPSE_TAKE_FRAME]
gcode = 
	{action_call_remote_method("timelapse_newframe")}

[gcode_macro TIMELAPSE_RENDER]
gcode = 
	{action_call_remote_method("timelapse_render")}

[bed_screws]
screw1 = 5,5
screw2 = 165,5
screw3 = 325,5
screw4 = 5,325
screw5 = 165,325
screw6 = 325,325

[screws_tilt_adjust]
screw1 = 60,22
screw1_name = front left screw
screw2 = 205,10
screw2_name = front middle screw
screw3 = 350,25
screw3_name = front right screw
screw4 = 50,325
screw4_name = back left screw
screw5 = 205,325
screw5_name = back middle screw
screw6 = 350,325
screw6_name = back right screw
horizontal_move_z = 10
speed = 120
screw_thread = CW-M3

[bed_mesh]
speed = 120
probe_count = 7,7
horizontal_move_z = 15
algorithm = bicubic
mesh_min = 30,20
mesh_max = 300,300
mesh_pps = 0,0

[probe]
x_offset = 41.5
y_offset = 5.1
pin = P1.25
speed = 20
z_offset = 1.540

[input_shaper]
shaper_freq_x = 52.6
shaper_type_x = 2hump_ei
shaper_freq_y = 44.6
shaper_type_y = 2hump_ei

[virtual_sdcard]
path = ~/gcode_files

[mcu]
serial = /dev/serial/by-id/usb-Klipper_lpc1768_0BA0FF02A99869AFEBF2415EC62000F5-if00
restart_method = command

[mcu rpi]
serial = /tmp/klipper_host_mcu

[adxl345]
cs_pin = rpi:None

[resonance_tester]
accel_chip = adxl345
probe_points = 
	165,165,20

[temperature_sensor Pi]
sensor_type = rpi_temperature
min_temp = 0
max_temp = 90

[temperature_sensor enclosure]
sensor_type = ATC Semitec 104GT-2
sensor_pin = P0.25

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_accel_to_decel = 3000
max_z_velocity = 25
max_z_accel = 30

[stepper_x]
step_pin = P2.2
dir_pin = !P2.3
enable_pin = !P2.1
rotation_distance = 40
endstop_pin = !P1.29
position_endstop = -19
position_min = -19
position_max = 311
homing_speed = 50
homing_retract_dist = 10
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_x]
uart_pin = P1.1
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_y]
step_pin = P0.19
dir_pin = P0.20
enable_pin = !P2.8
rotation_distance = 40
endstop_pin = !P1.27
position_endstop = -6
position_min = -6
position_max = 324
homing_retract_dist = 10
homing_speed = 50.0
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_y]
uart_pin = P1.8
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z]
step_pin = P1.9
dir_pin = !P1.14
enable_pin = !P0.10
rotation_distance = 8
microsteps = 16
endstop_pin = probe:z_virtual_endstop
position_max = 400
position_min = -10

[safe_z_home]
home_xy_position = 165,165
speed = 50
z_hop = 10
z_hop_speed = 5

[tmc2209 stepper_z]
uart_pin = P1.10
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z1]
step_pin = P0.22
dir_pin = !P2.11
enable_pin = !P0.21
rotation_distance = 8
microsteps = 16

[tmc2209 stepper_z1]
uart_pin = P1.17
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[z_tilt]
horizontal_move_z = 15
speed = 180
retries = 5
retry_tolerance = 0.01
z_positions = 
	50,165
	270,165
points = 
	10,165
	260,165

[extruder]
step_pin = P2.13
enable_pin = !P2.12
rotation_distance = 7.75
dir_pin = !P0.11
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = P2.7
sensor_type = PT1000
sensor_pin = P0.23
control = pid
pid_kp = 24.817
pid_ki = 1.157
pid_kd = 133.080
min_temp = 0
max_temp = 300
microsteps = 16
max_extrude_only_distance = 800.0

[tmc2209 extruder]
uart_pin = P1.15
interpolate = True
run_current = 0.500
hold_current = 0.500
sense_resistor = 0.110
stealthchop_threshold = 9999

[heater_bed]
heater_pin = P2.5
sensor_type = EPCOS 100K B57560G104F
sensor_pin = P0.24
control = pid
pid_kp = 54.027
pid_ki = 0.770
pid_kd = 948.182
min_temp = 0
max_temp = 130

[heater_fan hotend_fan]
pin = P1.4
heater = extruder
heater_temp = 50.0

[fan]
pin = P2.4
=======================
Loaded MCU 'mcu' 94 commands (v0.9.1-562-gacdad764 / gcc: (15:7-2018-q2-6) 7.3.1 20180622 (release) [ARM/embedded-7-branch revision 261907] binutils: (2.31.1-11+rpi1+11) 2.31.1)
MCU 'mcu' config: BUS_PINS_i2c1=P0.1,P0.0 BUS_PINS_i2c0=P0.28,P0.27 BUS_PINS_i2c2=P0.11,P0.10 BUS_PINS_i2c1a=P0.20,P0.19 BUS_PINS_ssp1=P0.8,P0.9,P0.7 STEP_DELAY=2 ADC_MAX=4095 BUS_PINS_ssp0=P0.17,P0.18,P0.15 PWM_MAX=255 CLOCK_FREQ=100000000 RESERVE_PINS_USB=P0.30,P0.29,P2.9 MCU=lpc1768 STATS_SUMSQ_BASE=256
Configured MCU 'mcu' (1024 moves)
Loaded MCU 'rpi' 101 commands (v0.9.1-616-g28f60f7e / gcc: (Raspbian 8.3.0-6+rpi1) 8.3.0 binutils: (GNU Binutils for Raspbian) 2.31.1)
MCU 'rpi' config: PCA9685_MAX=4096 ADC_MAX=4095 PWM_MAX=32768 CLOCK_FREQ=50000000 STEP_DELAY=2 MCU=linux STATS_SUMSQ_BASE=256
Configured MCU 'rpi' (1024 moves)
Args: ['/home/pi/klipper/klippy/klippy.py', '/home/pi/klipper_config/printer.cfg', '-l', '/home/pi/klipper_logs/klippy.log', '-a', '/tmp/klippy_uds']
Git version: 'v0.9.1-616-g28f60f7e'
CPU: 4 core ARMv7 Processor rev 3 (v7l)
Python: '2.7.16 (default, Oct 10 2019, 22:02:15) \n[GCC 8.3.0]'
webhooks client 3024848896: {'program': 'Moonraker', 'version': 'v0.7.1-194-geda5623'}
=============== Log rollover at Thu Dec  2 10:42:51 2021 ===============
Stats 38.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2444 bytes_read=7410 bytes_retransmit=9 bytes_invalid=0 send_seq=223 receive_seq=223 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007037 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000015 bytes_write=861 bytes_read=4437 bytes_retransmit=0 bytes_invalid=0 send_seq=120 receive_seq=120 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=49999977 adj=49996343  Pi: temp=28.7 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.51 cputime=1.130 memavail=1623892 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=22.0 pwm=0.000
Stats 39.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2450 bytes_read=7558 bytes_retransmit=9 bytes_invalid=0 send_seq=224 receive_seq=224 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007082 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000013 bytes_write=867 bytes_read=4466 bytes_retransmit=0 bytes_invalid=0 send_seq=121 receive_seq=121 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=49999975 adj=49996372  Pi: temp=28.7 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.51 cputime=1.139 memavail=1623428 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=21.7 pwm=0.000
Stats 40.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2456 bytes_read=7736 bytes_retransmit=9 bytes_invalid=0 send_seq=225 receive_seq=225 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007059 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000013 bytes_write=873 bytes_read=4482 bytes_retransmit=0 bytes_invalid=0 send_seq=122 receive_seq=122 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=49999968 adj=49996278  Pi: temp=30.2 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.47 cputime=1.147 memavail=1631852 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=21.8 pwm=0.000
Stats 41.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2462 bytes_read=7912 bytes_retransmit=9 bytes_invalid=0 send_seq=226 receive_seq=226 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007054 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000013 bytes_write=879 bytes_read=4498 bytes_retransmit=0 bytes_invalid=0 send_seq=123 receive_seq=123 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=49999995 adj=49996344  Pi: temp=30.2 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.47 cputime=1.157 memavail=1631812 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=22.1 pwm=0.000
Stats 42.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2468 bytes_read=8060 bytes_retransmit=9 bytes_invalid=0 send_seq=227 receive_seq=227 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007028 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000013 bytes_write=885 bytes_read=4514 bytes_retransmit=0 bytes_invalid=0 send_seq=124 receive_seq=124 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=50000018 adj=49996515  Pi: temp=29.2 enclosure: temp=20.3 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.47 cputime=1.165 memavail=1632232 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=22.2 pwm=0.000
Stats 43.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2474 bytes_read=8238 bytes_retransmit=9 bytes_invalid=0 send_seq=228 receive_seq=228 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007061 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000013 bytes_write=891 bytes_read=4530 bytes_retransmit=0 bytes_invalid=0 send_seq=125 receive_seq=125 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=50000026 adj=49996698  Pi: temp=29.2 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.47 cputime=1.176 memavail=1632448 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=22.1 pwm=0.000
Stats 44.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2480 bytes_read=8400 bytes_retransmit=9 bytes_invalid=0 send_seq=229 receive_seq=229 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007045 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000017 bytes_write=897 bytes_read=4559 bytes_retransmit=0 bytes_invalid=0 send_seq=126 receive_seq=126 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=50000049 adj=49996599  Pi: temp=29.7 enclosure: temp=20.3 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.47 cputime=1.183 memavail=1632508 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=21.9 pwm=0.000
Stats 45.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2486 bytes_read=8548 bytes_retransmit=9 bytes_invalid=0 send_seq=230 receive_seq=230 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007052 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000017 bytes_write=903 bytes_read=4575 bytes_retransmit=0 bytes_invalid=0 send_seq=127 receive_seq=127 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=50000054 adj=49996756  Pi: temp=28.7 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.35 cputime=1.191 memavail=1633292 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=21.9 pwm=0.000
Stats 46.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2492 bytes_read=8740 bytes_retransmit=9 bytes_invalid=0 send_seq=231 receive_seq=231 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007061 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000017 bytes_write=909 bytes_read=4591 bytes_retransmit=0 bytes_invalid=0 send_seq=128 receive_seq=128 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=50000062 adj=49996703  Pi: temp=30.2 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.35 cputime=1.202 memavail=1633272 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=22.0 pwm=0.000
Stats 47.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2498 bytes_read=8902 bytes_retransmit=9 bytes_invalid=0 send_seq=232 receive_seq=232 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007071 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000017 bytes_write=915 bytes_read=4607 bytes_retransmit=0 bytes_invalid=0 send_seq=129 receive_seq=129 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=50000066 adj=49996680  Pi: temp=29.2 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.35 cputime=1.213 memavail=1633324 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=22.0 pwm=0.000
Stats 48.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2504 bytes_read=9050 bytes_retransmit=9 bytes_invalid=0 send_seq=233 receive_seq=233 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007052 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000017 bytes_write=921 bytes_read=4623 bytes_retransmit=0 bytes_invalid=0 send_seq=130 receive_seq=130 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=50000068 adj=49996640  Pi: temp=29.2 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.35 cputime=1.220 memavail=1633496 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=22.1 pwm=0.000
Stats 49.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2510 bytes_read=9228 bytes_retransmit=9 bytes_invalid=0 send_seq=234 receive_seq=234 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007037 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000018 bytes_write=927 bytes_read=4652 bytes_retransmit=0 bytes_invalid=0 send_seq=131 receive_seq=131 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=50000071 adj=49996685  Pi: temp=29.7 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.35 cputime=1.229 memavail=1633328 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=22.0 pwm=0.000
Stats 50.6: gcodein=0 mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=2516 bytes_read=9390 bytes_retransmit=9 bytes_invalid=0 send_seq=235 receive_seq=235 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=100007048 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000018 bytes_write=933 bytes_read=4668 bytes_retransmit=0 bytes_invalid=0 send_seq=132 receive_seq=132 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 stalled_bytes=0 freq=50000070 adj=49996723  Pi: temp=28.7 enclosure: temp=20.4 heater_bed: target=0 temp=20.6 pwm=0.000 sysload=1.24 cputime=1.241 memavail=1633356 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=21.7 pwm=0.000
Resetting prediction variance 1508.357: freq=49999414 diff=-39325 stddev=5362.153
Starting Klippy...
Args: ['/home/pi/klipper/klippy/klippy.py', '/home/pi/klipper_config/printer.cfg', '-l', '/home/pi/klipper_logs/klippy.log', '-a', '/tmp/klippy_uds']
Git version: 'v0.10.0-171-g8b2da0d3'
CPU: 4 core ARMv7 Processor rev 3 (v7l)
Python: '2.7.16 (default, Oct 10 2019, 22:02:15) \n[GCC 8.3.0]'
Building C code module c_helper.so
Starting Klippy...
Args: ['/home/pi/klipper/klippy/klippy.py', '/home/pi/klipper_config/printer.cfg', '-l', '/home/pi/klipper_logs/klippy.log', '-a', '/tmp/klippy_uds']
Git version: 'v0.10.0-171-g8b2da0d3'
CPU: 4 core ARMv7 Processor rev 3 (v7l)
Python: '2.7.16 (default, Oct 10 2019, 22:02:15) \n[GCC 8.3.0]'
Start printer at Thu Dec  2 11:14:15 2021 (1638472455.5 1922.8)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro START_PRINT]
gcode = 
	CLEAR_PAUSE
	M117 Print Starting...
	M104 S{T_EXTRUDER}
	M140 S{T_BED}
	{% if printer.heater_bed.temperature < params.T_BED|float*0.95 %}
	M190 S{params.T_BED|float*0.95}
	{% endif %}
	M117 Homing All...
	G28
	G92 E0 ; Reset Extruder distance to 0
	G1 E-2 ; Retracts filament to prevent blobs during probing
	Z_TILT_ADJUST
	LEVEL_BED
	G90
	G92 E0
	SET_GCODE_OFFSET Z=0
	G1 X15 Y20 Z5 F6000
	M117 Waiting for Temps
	M190 S{T_BED}
	M109 S{T_EXTRUDER}
	PRIME_LINE
	M117 Printing.....

[gcode_macro END_PRINT]
gcode = 
	SAVE_GCODE_STATE NAME=end_print
	M117 Done printing
	G91
	G1 E-10 F3600
	G90
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < 100 %}
	{% set z_safe = 100.0 %}
	{% else %}
	{% set z_safe = 0 %}
	{% endif %}
	{% set x_max = printer.toolhead.axis_maximum.x|float - 3 %}
	{% set y_max = printer.toolhead.axis_maximum.y|float - 3 %}
	G1 X{x_max} Y{y_max} Z{z_safe} F2000
	M104 S0         ;Disable Hot End
	M140 S0         ;Disable Heat Bed
	RESTORE_GCODE_STATE NAME=end_print
	M84             ;Disable Steppers
	BED_MESH_CLEAR

[gcode_macro PRIME_LINE]
gcode = 
	M117 Prime Line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up
	G1 X0 Y30 Z2.28 F5000 ;Move to start position
	G1 X0 Y200.0 Z2.28 F500 E15 ;Draw the first line
	G1 X1 Y200.0 Z2.28 F5000 ;Move to side a little
	G1 X1 Y50 Z2.28 F500 E30 ;Draw the second line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up

[gcode_macro G29]
gcode = 
	G28
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE save=default

[gcode_macro LEVEL_BED]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro M204]
rename_existing = M204.1
default_parameter_f = 0.75
gcode = 
	{% if 'S' in params %}
	SET_VELOCITY_LIMIT ACCEL={ S } ACCEL_TO_DECEL={ S|float * F|float }
	{% endif %}
	{% if 'P' in params %}
	SET_VELOCITY_LIMIT ACCEL={ P } ACCEL_TO_DECEL={ P|float * F|float }
	{% endif %}

[gcode_macro M205]
gcode = 
	{% if 'X' in params %}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={ X }
	{% endif %}

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% if printer.extruder.target != 0 %}
	{% if printer.extruder.temperature < printer.extruder.target %}
	M117 Heating from {printer.extruder.temperature} to {printer.extruder.target}.
	M109 S{printer.extruder.target|float}
	{% endif %}
	{% else %}
	{% if printer.extruder.target < T %}
	M117 No setpoint, heating to {T}.
	M109 S{T}
	{% endif %}
	{% endif %}

[gcode_macro M600]
gcode = 
	PAUSE_MACRO
	UNLOAD

[gcode_macro M601]
gcode = 
	PAUSE_MACRO

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro PAUSE_MACRO]
gcode = 
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=bed_temp VALUE={printer.heater_bed.target}
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=extruder_temp VALUE={printer.extruder.target}
	M117 Parking...
	PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=28800
variable_bed_temp = 0
variable_extruder_temp = 0

[gcode_macro RESUME_MACRO]
gcode = 
	M117 Heating Back Up...
	M140 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M104 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	M190 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M109 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	SET_IDLE_TIMEOUT TIMEOUT=600
	M117  Resuming...
	RESUME

[gcode_macro LOAD]
gcode = 
	SAVE_GCODE_STATE NAME=loading_filament
	M83
	G92 E0.0
	G1 E10 F1000
	G1 E100 F200
	G92 E0.0
	RESTORE_GCODE_STATE NAME=loading_filament

[gcode_macro UNLOAD]
gcode = 
	SAVE_GCODE_STATE NAME=unloading_filament
	G91
	G1 E10 F100
	G92 E0.0
	G1 E-150 F1000
	G92 E0.0
	RESTORE_GCODE_STATE NAME=unloading_filament

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro TIMELAPSE_TAKE_FRAME]
gcode = 
	{action_call_remote_method("timelapse_newframe")}

[gcode_macro TIMELAPSE_RENDER]
gcode = 
	{action_call_remote_method("timelapse_render")}

[bed_screws]
screw1 = 5,5
screw2 = 165,5
screw3 = 325,5
screw4 = 5,325
screw5 = 165,325
screw6 = 325,325

[screws_tilt_adjust]
screw1 = 60,22
screw1_name = front left screw
screw2 = 205,10
screw2_name = front middle screw
screw3 = 350,25
screw3_name = front right screw
screw4 = 50,325
screw4_name = back left screw
screw5 = 205,325
screw5_name = back middle screw
screw6 = 350,325
screw6_name = back right screw
horizontal_move_z = 10
speed = 120
screw_thread = CW-M3

[bed_mesh]
speed = 120
probe_count = 7,7
horizontal_move_z = 15
algorithm = bicubic
mesh_min = 30,20
mesh_max = 300,300
mesh_pps = 0,0

[probe]
x_offset = 41.5
y_offset = 5.1
pin = P1.25
speed = 20
z_offset = 1.540

[input_shaper]
shaper_freq_x = 52.6
shaper_type_x = 2hump_ei
shaper_freq_y = 44.6
shaper_type_y = 2hump_ei

[virtual_sdcard]
path = ~/gcode_files

[mcu]
serial = /dev/serial/by-id/usb-Klipper_lpc1768_0BA0FF02A99869AFEBF2415EC62000F5-if00
restart_method = command

[mcu rpi]
serial = /tmp/klipper_host_mcu

[adxl345]
cs_pin = rpi:None

[resonance_tester]
accel_chip = adxl345
probe_points = 
	165,165,20

[temperature_sensor Pi]
sensor_type = rpi_temperature
min_temp = 0
max_temp = 90

[temperature_sensor enclosure]
sensor_type = ATC Semitec 104GT-2
sensor_pin = P0.25

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_accel_to_decel = 3000
max_z_velocity = 25
max_z_accel = 30

[stepper_x]
step_pin = P2.2
dir_pin = !P2.3
enable_pin = !P2.1
rotation_distance = 40
endstop_pin = !P1.29
position_endstop = -19
position_min = -19
position_max = 311
homing_speed = 50
homing_retract_dist = 10
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_x]
uart_pin = P1.1
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_y]
step_pin = P0.19
dir_pin = P0.20
enable_pin = !P2.8
rotation_distance = 40
endstop_pin = !P1.27
position_endstop = -6
position_min = -6
position_max = 324
homing_retract_dist = 10
homing_speed = 50.0
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_y]
uart_pin = P1.8
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z]
step_pin = P1.9
dir_pin = !P1.14
enable_pin = !P0.10
rotation_distance = 8
microsteps = 16
endstop_pin = probe:z_virtual_endstop
position_max = 400
position_min = -10

[safe_z_home]
home_xy_position = 165,165
speed = 50
z_hop = 10
z_hop_speed = 5

[tmc2209 stepper_z]
uart_pin = P1.10
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z1]
step_pin = P0.22
dir_pin = !P2.11
enable_pin = !P0.21
rotation_distance = 8
microsteps = 16

[tmc2209 stepper_z1]
uart_pin = P1.17
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[z_tilt]
horizontal_move_z = 15
speed = 180
retries = 5
retry_tolerance = 0.01
z_positions = 
	50,165
	270,165
points = 
	10,165
	260,165

[extruder]
step_pin = P2.13
enable_pin = !P2.12
rotation_distance = 7.75
dir_pin = !P0.11
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = P2.7
sensor_type = PT1000
sensor_pin = P0.23
control = pid
pid_kp = 24.817
pid_ki = 1.157
pid_kd = 133.080
min_temp = 0
max_temp = 300
microsteps = 16
max_extrude_only_distance = 800.0

[tmc2209 extruder]
uart_pin = P1.15
interpolate = True
run_current = 0.500
hold_current = 0.500
sense_resistor = 0.110
stealthchop_threshold = 9999

[heater_bed]
heater_pin = P2.5
sensor_type = EPCOS 100K B57560G104F
sensor_pin = P0.24
control = pid
pid_kp = 54.027
pid_ki = 0.770
pid_kd = 948.182
min_temp = 0
max_temp = 130

[heater_fan hotend_fan]
pin = P1.4
heater = extruder
heater_temp = 50.0

[fan]
pin = P2.4
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 157, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 141, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/pi/klipper/klippy/klippy.py", line 130, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/pi/klipper/klippy/extras/temperature_sensor.py", line 42, in load_config_prefix
    return PrinterSensorGeneric(config)
  File "/home/pi/klipper/klippy/extras/temperature_sensor.py", line 14, in __init__
    self.sensor = pheaters.setup_sensor(config)
  File "/home/pi/klipper/klippy/extras/heaters.py", line 282, in setup_sensor
    "Unknown temperature sensor '%s'" % (sensor_type,))
Error: Unknown temperature sensor 'rpi_temperature'
webhooks client 3042834432: New connection
webhooks client 3042834432: Client info {'program': 'Moonraker', 'version': 'v0.7.1-194-geda5623'}
webhooks client 3042834432: Disconnected
Restarting printer
Start printer at Thu Dec  2 11:14:52 2021 (1638472492.6 1960.0)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro START_PRINT]
gcode = 
	CLEAR_PAUSE
	M117 Print Starting...
	M104 S{T_EXTRUDER}
	M140 S{T_BED}
	{% if printer.heater_bed.temperature < params.T_BED|float*0.95 %}
	M190 S{params.T_BED|float*0.95}
	{% endif %}
	M117 Homing All...
	G28
	G92 E0 ; Reset Extruder distance to 0
	G1 E-2 ; Retracts filament to prevent blobs during probing
	Z_TILT_ADJUST
	LEVEL_BED
	G90
	G92 E0
	SET_GCODE_OFFSET Z=0
	G1 X15 Y20 Z5 F6000
	M117 Waiting for Temps
	M190 S{T_BED}
	M109 S{T_EXTRUDER}
	PRIME_LINE
	M117 Printing.....

[gcode_macro END_PRINT]
gcode = 
	SAVE_GCODE_STATE NAME=end_print
	M117 Done printing
	G91
	G1 E-10 F3600
	G90
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < 100 %}
	{% set z_safe = 100.0 %}
	{% else %}
	{% set z_safe = 0 %}
	{% endif %}
	{% set x_max = printer.toolhead.axis_maximum.x|float - 3 %}
	{% set y_max = printer.toolhead.axis_maximum.y|float - 3 %}
	G1 X{x_max} Y{y_max} Z{z_safe} F2000
	M104 S0         ;Disable Hot End
	M140 S0         ;Disable Heat Bed
	RESTORE_GCODE_STATE NAME=end_print
	M84             ;Disable Steppers
	BED_MESH_CLEAR

[gcode_macro PRIME_LINE]
gcode = 
	M117 Prime Line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up
	G1 X0 Y30 Z2.28 F5000 ;Move to start position
	G1 X0 Y200.0 Z2.28 F500 E15 ;Draw the first line
	G1 X1 Y200.0 Z2.28 F5000 ;Move to side a little
	G1 X1 Y50 Z2.28 F500 E30 ;Draw the second line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up

[gcode_macro G29]
gcode = 
	G28
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE save=default

[gcode_macro LEVEL_BED]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro M204]
rename_existing = M204.1
default_parameter_f = 0.75
gcode = 
	{% if 'S' in params %}
	SET_VELOCITY_LIMIT ACCEL={ S } ACCEL_TO_DECEL={ S|float * F|float }
	{% endif %}
	{% if 'P' in params %}
	SET_VELOCITY_LIMIT ACCEL={ P } ACCEL_TO_DECEL={ P|float * F|float }
	{% endif %}

[gcode_macro M205]
gcode = 
	{% if 'X' in params %}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={ X }
	{% endif %}

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% if printer.extruder.target != 0 %}
	{% if printer.extruder.temperature < printer.extruder.target %}
	M117 Heating from {printer.extruder.temperature} to {printer.extruder.target}.
	M109 S{printer.extruder.target|float}
	{% endif %}
	{% else %}
	{% if printer.extruder.target < T %}
	M117 No setpoint, heating to {T}.
	M109 S{T}
	{% endif %}
	{% endif %}

[gcode_macro M600]
gcode = 
	PAUSE_MACRO
	UNLOAD

[gcode_macro M601]
gcode = 
	PAUSE_MACRO

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro PAUSE_MACRO]
gcode = 
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=bed_temp VALUE={printer.heater_bed.target}
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=extruder_temp VALUE={printer.extruder.target}
	M117 Parking...
	PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=28800
variable_bed_temp = 0
variable_extruder_temp = 0

[gcode_macro RESUME_MACRO]
gcode = 
	M117 Heating Back Up...
	M140 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M104 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	M190 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M109 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	SET_IDLE_TIMEOUT TIMEOUT=600
	M117  Resuming...
	RESUME

[gcode_macro LOAD]
gcode = 
	SAVE_GCODE_STATE NAME=loading_filament
	M83
	G92 E0.0
	G1 E10 F1000
	G1 E100 F200
	G92 E0.0
	RESTORE_GCODE_STATE NAME=loading_filament

[gcode_macro UNLOAD]
gcode = 
	SAVE_GCODE_STATE NAME=unloading_filament
	G91
	G1 E10 F100
	G92 E0.0
	G1 E-150 F1000
	G92 E0.0
	RESTORE_GCODE_STATE NAME=unloading_filament

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro TIMELAPSE_TAKE_FRAME]
gcode = 
	{action_call_remote_method("timelapse_newframe")}

[gcode_macro TIMELAPSE_RENDER]
gcode = 
	{action_call_remote_method("timelapse_render")}

[bed_screws]
screw1 = 5,5
screw2 = 165,5
screw3 = 325,5
screw4 = 5,325
screw5 = 165,325
screw6 = 325,325

[screws_tilt_adjust]
screw1 = 60,22
screw1_name = front left screw
screw2 = 205,10
screw2_name = front middle screw
screw3 = 350,25
screw3_name = front right screw
screw4 = 50,325
screw4_name = back left screw
screw5 = 205,325
screw5_name = back middle screw
screw6 = 350,325
screw6_name = back right screw
horizontal_move_z = 10
speed = 120
screw_thread = CW-M3

[bed_mesh]
speed = 120
probe_count = 7,7
horizontal_move_z = 15
algorithm = bicubic
mesh_min = 30,20
mesh_max = 300,300
mesh_pps = 0,0

[probe]
x_offset = 41.5
y_offset = 5.1
pin = P1.25
speed = 20
z_offset = 1.540

[input_shaper]
shaper_freq_x = 52.6
shaper_type_x = 2hump_ei
shaper_freq_y = 44.6
shaper_type_y = 2hump_ei

[virtual_sdcard]
path = ~/gcode_files

[mcu]
serial = /dev/serial/by-id/usb-Klipper_lpc1768_0BA0FF02A99869AFEBF2415EC62000F5-if00
restart_method = command

[mcu rpi]
serial = /tmp/klipper_host_mcu

[adxl345]
cs_pin = rpi:None

[resonance_tester]
accel_chip = adxl345
probe_points = 
	165,165,20

[temperature_sensor Pi]
sensor_type = rpi_temperature
min_temp = 0
max_temp = 90

[temperature_sensor enclosure]
sensor_type = ATC Semitec 104GT-2
sensor_pin = P0.25

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_accel_to_decel = 3000
max_z_velocity = 25
max_z_accel = 30

[stepper_x]
step_pin = P2.2
dir_pin = !P2.3
enable_pin = !P2.1
rotation_distance = 40
endstop_pin = !P1.29
position_endstop = -19
position_min = -19
position_max = 311
homing_speed = 50
homing_retract_dist = 10
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_x]
uart_pin = P1.1
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_y]
step_pin = P0.19
dir_pin = P0.20
enable_pin = !P2.8
rotation_distance = 40
endstop_pin = !P1.27
position_endstop = -6
position_min = -6
position_max = 324
homing_retract_dist = 10
homing_speed = 50.0
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_y]
uart_pin = P1.8
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z]
step_pin = P1.9
dir_pin = !P1.14
enable_pin = !P0.10
rotation_distance = 8
microsteps = 16
endstop_pin = probe:z_virtual_endstop
position_max = 400
position_min = -10

[safe_z_home]
home_xy_position = 165,165
speed = 50
z_hop = 10
z_hop_speed = 5

[tmc2209 stepper_z]
uart_pin = P1.10
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z1]
step_pin = P0.22
dir_pin = !P2.11
enable_pin = !P0.21
rotation_distance = 8
microsteps = 16

[tmc2209 stepper_z1]
uart_pin = P1.17
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[z_tilt]
horizontal_move_z = 15
speed = 180
retries = 5
retry_tolerance = 0.01
z_positions = 
	50,165
	270,165
points = 
	10,165
	260,165

[extruder]
step_pin = P2.13
enable_pin = !P2.12
rotation_distance = 7.75
dir_pin = !P0.11
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = P2.7
sensor_type = PT1000
sensor_pin = P0.23
control = pid
pid_kp = 24.817
pid_ki = 1.157
pid_kd = 133.080
min_temp = 0
max_temp = 300
microsteps = 16
max_extrude_only_distance = 800.0

[tmc2209 extruder]
uart_pin = P1.15
interpolate = True
run_current = 0.500
hold_current = 0.500
sense_resistor = 0.110
stealthchop_threshold = 9999

[heater_bed]
heater_pin = P2.5
sensor_type = EPCOS 100K B57560G104F
sensor_pin = P0.24
control = pid
pid_kp = 54.027
pid_ki = 0.770
pid_kd = 948.182
min_temp = 0
max_temp = 130

[heater_fan hotend_fan]
pin = P1.4
heater = extruder
heater_temp = 50.0

[fan]
pin = P2.4
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 157, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 141, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/pi/klipper/klippy/klippy.py", line 130, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/pi/klipper/klippy/extras/temperature_sensor.py", line 42, in load_config_prefix
    return PrinterSensorGeneric(config)
  File "/home/pi/klipper/klippy/extras/temperature_sensor.py", line 14, in __init__
    self.sensor = pheaters.setup_sensor(config)
  File "/home/pi/klipper/klippy/extras/heaters.py", line 282, in setup_sensor
    "Unknown temperature sensor '%s'" % (sensor_type,))
Error: Unknown temperature sensor 'rpi_temperature'
webhooks client 3042369408: New connection
webhooks client 3042369408: Client info {'program': 'Moonraker', 'version': 'v0.7.1-194-geda5623'}
Unable to issue reset command on MCU 'mcu'
Unable to issue reset command on MCU 'rpi'
webhooks client 3042369408: Disconnected
Restarting printer
Start printer at Thu Dec  2 11:14:56 2021 (1638472496.4 1963.7)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro START_PRINT]
gcode = 
	CLEAR_PAUSE
	M117 Print Starting...
	M104 S{T_EXTRUDER}
	M140 S{T_BED}
	{% if printer.heater_bed.temperature < params.T_BED|float*0.95 %}
	M190 S{params.T_BED|float*0.95}
	{% endif %}
	M117 Homing All...
	G28
	G92 E0 ; Reset Extruder distance to 0
	G1 E-2 ; Retracts filament to prevent blobs during probing
	Z_TILT_ADJUST
	LEVEL_BED
	G90
	G92 E0
	SET_GCODE_OFFSET Z=0
	G1 X15 Y20 Z5 F6000
	M117 Waiting for Temps
	M190 S{T_BED}
	M109 S{T_EXTRUDER}
	PRIME_LINE
	M117 Printing.....

[gcode_macro END_PRINT]
gcode = 
	SAVE_GCODE_STATE NAME=end_print
	M117 Done printing
	G91
	G1 E-10 F3600
	G90
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < 100 %}
	{% set z_safe = 100.0 %}
	{% else %}
	{% set z_safe = 0 %}
	{% endif %}
	{% set x_max = printer.toolhead.axis_maximum.x|float - 3 %}
	{% set y_max = printer.toolhead.axis_maximum.y|float - 3 %}
	G1 X{x_max} Y{y_max} Z{z_safe} F2000
	M104 S0         ;Disable Hot End
	M140 S0         ;Disable Heat Bed
	RESTORE_GCODE_STATE NAME=end_print
	M84             ;Disable Steppers
	BED_MESH_CLEAR

[gcode_macro PRIME_LINE]
gcode = 
	M117 Prime Line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up
	G1 X0 Y30 Z2.28 F5000 ;Move to start position
	G1 X0 Y200.0 Z2.28 F500 E15 ;Draw the first line
	G1 X1 Y200.0 Z2.28 F5000 ;Move to side a little
	G1 X1 Y50 Z2.28 F500 E30 ;Draw the second line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up

[gcode_macro G29]
gcode = 
	G28
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE save=default

[gcode_macro LEVEL_BED]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro M204]
rename_existing = M204.1
default_parameter_f = 0.75
gcode = 
	{% if 'S' in params %}
	SET_VELOCITY_LIMIT ACCEL={ S } ACCEL_TO_DECEL={ S|float * F|float }
	{% endif %}
	{% if 'P' in params %}
	SET_VELOCITY_LIMIT ACCEL={ P } ACCEL_TO_DECEL={ P|float * F|float }
	{% endif %}

[gcode_macro M205]
gcode = 
	{% if 'X' in params %}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={ X }
	{% endif %}

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% if printer.extruder.target != 0 %}
	{% if printer.extruder.temperature < printer.extruder.target %}
	M117 Heating from {printer.extruder.temperature} to {printer.extruder.target}.
	M109 S{printer.extruder.target|float}
	{% endif %}
	{% else %}
	{% if printer.extruder.target < T %}
	M117 No setpoint, heating to {T}.
	M109 S{T}
	{% endif %}
	{% endif %}

[gcode_macro M600]
gcode = 
	PAUSE_MACRO
	UNLOAD

[gcode_macro M601]
gcode = 
	PAUSE_MACRO

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro PAUSE_MACRO]
gcode = 
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=bed_temp VALUE={printer.heater_bed.target}
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=extruder_temp VALUE={printer.extruder.target}
	M117 Parking...
	PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=28800
variable_bed_temp = 0
variable_extruder_temp = 0

[gcode_macro RESUME_MACRO]
gcode = 
	M117 Heating Back Up...
	M140 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M104 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	M190 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M109 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	SET_IDLE_TIMEOUT TIMEOUT=600
	M117  Resuming...
	RESUME

[gcode_macro LOAD]
gcode = 
	SAVE_GCODE_STATE NAME=loading_filament
	M83
	G92 E0.0
	G1 E10 F1000
	G1 E100 F200
	G92 E0.0
	RESTORE_GCODE_STATE NAME=loading_filament

[gcode_macro UNLOAD]
gcode = 
	SAVE_GCODE_STATE NAME=unloading_filament
	G91
	G1 E10 F100
	G92 E0.0
	G1 E-150 F1000
	G92 E0.0
	RESTORE_GCODE_STATE NAME=unloading_filament

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro TIMELAPSE_TAKE_FRAME]
gcode = 
	{action_call_remote_method("timelapse_newframe")}

[gcode_macro TIMELAPSE_RENDER]
gcode = 
	{action_call_remote_method("timelapse_render")}

[bed_screws]
screw1 = 5,5
screw2 = 165,5
screw3 = 325,5
screw4 = 5,325
screw5 = 165,325
screw6 = 325,325

[screws_tilt_adjust]
screw1 = 60,22
screw1_name = front left screw
screw2 = 205,10
screw2_name = front middle screw
screw3 = 350,25
screw3_name = front right screw
screw4 = 50,325
screw4_name = back left screw
screw5 = 205,325
screw5_name = back middle screw
screw6 = 350,325
screw6_name = back right screw
horizontal_move_z = 10
speed = 120
screw_thread = CW-M3

[bed_mesh]
speed = 120
probe_count = 7,7
horizontal_move_z = 15
algorithm = bicubic
mesh_min = 30,20
mesh_max = 300,300
mesh_pps = 0,0

[probe]
x_offset = 41.5
y_offset = 5.1
pin = P1.25
speed = 20
z_offset = 1.540

[input_shaper]
shaper_freq_x = 52.6
shaper_type_x = 2hump_ei
shaper_freq_y = 44.6
shaper_type_y = 2hump_ei

[virtual_sdcard]
path = ~/gcode_files

[mcu]
serial = /dev/serial/by-id/usb-Klipper_lpc1768_0BA0FF02A99869AFEBF2415EC62000F5-if00
restart_method = command

[mcu rpi]
serial = /tmp/klipper_host_mcu

[adxl345]
cs_pin = rpi:None

[resonance_tester]
accel_chip = adxl345
probe_points = 
	165,165,20

[temperature_sensor Pi]
sensor_type = rpi_temperature
min_temp = 0
max_temp = 90

[temperature_sensor enclosure]
sensor_type = ATC Semitec 104GT-2
sensor_pin = P0.25

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_accel_to_decel = 3000
max_z_velocity = 25
max_z_accel = 30

[stepper_x]
step_pin = P2.2
dir_pin = !P2.3
enable_pin = !P2.1
rotation_distance = 40
endstop_pin = !P1.29
position_endstop = -19
position_min = -19
position_max = 311
homing_speed = 50
homing_retract_dist = 10
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_x]
uart_pin = P1.1
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_y]
step_pin = P0.19
dir_pin = P0.20
enable_pin = !P2.8
rotation_distance = 40
endstop_pin = !P1.27
position_endstop = -6
position_min = -6
position_max = 324
homing_retract_dist = 10
homing_speed = 50.0
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_y]
uart_pin = P1.8
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z]
step_pin = P1.9
dir_pin = !P1.14
enable_pin = !P0.10
rotation_distance = 8
microsteps = 16
endstop_pin = probe:z_virtual_endstop
position_max = 400
position_min = -10

[safe_z_home]
home_xy_position = 165,165
speed = 50
z_hop = 10
z_hop_speed = 5

[tmc2209 stepper_z]
uart_pin = P1.10
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z1]
step_pin = P0.22
dir_pin = !P2.11
enable_pin = !P0.21
rotation_distance = 8
microsteps = 16

[tmc2209 stepper_z1]
uart_pin = P1.17
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[z_tilt]
horizontal_move_z = 15
speed = 180
retries = 5
retry_tolerance = 0.01
z_positions = 
	50,165
	270,165
points = 
	10,165
	260,165

[extruder]
step_pin = P2.13
enable_pin = !P2.12
rotation_distance = 7.75
dir_pin = !P0.11
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = P2.7
sensor_type = PT1000
sensor_pin = P0.23
control = pid
pid_kp = 24.817
pid_ki = 1.157
pid_kd = 133.080
min_temp = 0
max_temp = 300
microsteps = 16
max_extrude_only_distance = 800.0

[tmc2209 extruder]
uart_pin = P1.15
interpolate = True
run_current = 0.500
hold_current = 0.500
sense_resistor = 0.110
stealthchop_threshold = 9999

[heater_bed]
heater_pin = P2.5
sensor_type = EPCOS 100K B57560G104F
sensor_pin = P0.24
control = pid
pid_kp = 54.027
pid_ki = 0.770
pid_kd = 948.182
min_temp = 0
max_temp = 130

[heater_fan hotend_fan]
pin = P1.4
heater = extruder
heater_temp = 50.0

[fan]
pin = P2.4
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 157, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 141, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/pi/klipper/klippy/klippy.py", line 130, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/pi/klipper/klippy/extras/temperature_sensor.py", line 42, in load_config_prefix
    return PrinterSensorGeneric(config)
  File "/home/pi/klipper/klippy/extras/temperature_sensor.py", line 14, in __init__
    self.sensor = pheaters.setup_sensor(config)
  File "/home/pi/klipper/klippy/extras/heaters.py", line 282, in setup_sensor
    "Unknown temperature sensor '%s'" % (sensor_type,))
Error: Unknown temperature sensor 'rpi_temperature'
webhooks client 3044324096: New connection
webhooks client 3044324096: Client info {'program': 'Moonraker', 'version': 'v0.7.1-194-geda5623'}
Starting Klippy...
Args: ['/home/pi/klipper/klippy/klippy.py', '/home/pi/klipper_config/printer.cfg', '-l', '/home/pi/klipper_logs/klippy.log', '-a', '/tmp/klippy_uds']
Git version: 'v0.10.0-171-g8b2da0d3'
CPU: 4 core ARMv7 Processor rev 3 (v7l)
Python: '2.7.16 (default, Oct 10 2019, 22:02:15) \n[GCC 8.3.0]'
Start printer at Thu Dec  2 11:16:36 2021 (1638472596.7 2064.0)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro START_PRINT]
gcode = 
	CLEAR_PAUSE
	M117 Print Starting...
	M104 S{T_EXTRUDER}
	M140 S{T_BED}
	{% if printer.heater_bed.temperature < params.T_BED|float*0.95 %}
	M190 S{params.T_BED|float*0.95}
	{% endif %}
	M117 Homing All...
	G28
	G92 E0 ; Reset Extruder distance to 0
	G1 E-2 ; Retracts filament to prevent blobs during probing
	Z_TILT_ADJUST
	LEVEL_BED
	G90
	G92 E0
	SET_GCODE_OFFSET Z=0
	G1 X15 Y20 Z5 F6000
	M117 Waiting for Temps
	M190 S{T_BED}
	M109 S{T_EXTRUDER}
	PRIME_LINE
	M117 Printing.....

[gcode_macro END_PRINT]
gcode = 
	SAVE_GCODE_STATE NAME=end_print
	M117 Done printing
	G91
	G1 E-10 F3600
	G90
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < 100 %}
	{% set z_safe = 100.0 %}
	{% else %}
	{% set z_safe = 0 %}
	{% endif %}
	{% set x_max = printer.toolhead.axis_maximum.x|float - 3 %}
	{% set y_max = printer.toolhead.axis_maximum.y|float - 3 %}
	G1 X{x_max} Y{y_max} Z{z_safe} F2000
	M104 S0         ;Disable Hot End
	M140 S0         ;Disable Heat Bed
	RESTORE_GCODE_STATE NAME=end_print
	M84             ;Disable Steppers
	BED_MESH_CLEAR

[gcode_macro PRIME_LINE]
gcode = 
	M117 Prime Line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up
	G1 X0 Y30 Z2.28 F5000 ;Move to start position
	G1 X0 Y200.0 Z2.28 F500 E15 ;Draw the first line
	G1 X1 Y200.0 Z2.28 F5000 ;Move to side a little
	G1 X1 Y50 Z2.28 F500 E30 ;Draw the second line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up

[gcode_macro G29]
gcode = 
	G28
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE save=default

[gcode_macro LEVEL_BED]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro M204]
rename_existing = M204.1
default_parameter_f = 0.75
gcode = 
	{% if 'S' in params %}
	SET_VELOCITY_LIMIT ACCEL={ S } ACCEL_TO_DECEL={ S|float * F|float }
	{% endif %}
	{% if 'P' in params %}
	SET_VELOCITY_LIMIT ACCEL={ P } ACCEL_TO_DECEL={ P|float * F|float }
	{% endif %}

[gcode_macro M205]
gcode = 
	{% if 'X' in params %}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={ X }
	{% endif %}

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% if printer.extruder.target != 0 %}
	{% if printer.extruder.temperature < printer.extruder.target %}
	M117 Heating from {printer.extruder.temperature} to {printer.extruder.target}.
	M109 S{printer.extruder.target|float}
	{% endif %}
	{% else %}
	{% if printer.extruder.target < T %}
	M117 No setpoint, heating to {T}.
	M109 S{T}
	{% endif %}
	{% endif %}

[gcode_macro M600]
gcode = 
	PAUSE_MACRO
	UNLOAD

[gcode_macro M601]
gcode = 
	PAUSE_MACRO

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro PAUSE_MACRO]
gcode = 
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=bed_temp VALUE={printer.heater_bed.target}
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=extruder_temp VALUE={printer.extruder.target}
	M117 Parking...
	PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=28800
variable_bed_temp = 0
variable_extruder_temp = 0

[gcode_macro RESUME_MACRO]
gcode = 
	M117 Heating Back Up...
	M140 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M104 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	M190 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M109 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	SET_IDLE_TIMEOUT TIMEOUT=600
	M117  Resuming...
	RESUME

[gcode_macro LOAD]
gcode = 
	SAVE_GCODE_STATE NAME=loading_filament
	M83
	G92 E0.0
	G1 E10 F1000
	G1 E100 F200
	G92 E0.0
	RESTORE_GCODE_STATE NAME=loading_filament

[gcode_macro UNLOAD]
gcode = 
	SAVE_GCODE_STATE NAME=unloading_filament
	G91
	G1 E10 F100
	G92 E0.0
	G1 E-150 F1000
	G92 E0.0
	RESTORE_GCODE_STATE NAME=unloading_filament

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro TIMELAPSE_TAKE_FRAME]
gcode = 
	{action_call_remote_method("timelapse_newframe")}

[gcode_macro TIMELAPSE_RENDER]
gcode = 
	{action_call_remote_method("timelapse_render")}

[bed_screws]
screw1 = 5,5
screw2 = 165,5
screw3 = 325,5
screw4 = 5,325
screw5 = 165,325
screw6 = 325,325

[screws_tilt_adjust]
screw1 = 60,22
screw1_name = front left screw
screw2 = 205,10
screw2_name = front middle screw
screw3 = 350,25
screw3_name = front right screw
screw4 = 50,325
screw4_name = back left screw
screw5 = 205,325
screw5_name = back middle screw
screw6 = 350,325
screw6_name = back right screw
horizontal_move_z = 10
speed = 120
screw_thread = CW-M3

[bed_mesh]
speed = 120
probe_count = 7,7
horizontal_move_z = 15
algorithm = bicubic
mesh_min = 30,20
mesh_max = 300,300
mesh_pps = 0,0

[probe]
x_offset = 41.5
y_offset = 5.1
pin = P1.25
speed = 20
z_offset = 1.540

[input_shaper]
shaper_freq_x = 52.6
shaper_type_x = 2hump_ei
shaper_freq_y = 44.6
shaper_type_y = 2hump_ei

[virtual_sdcard]
path = ~/gcode_files

[mcu]
serial = /dev/serial/by-id/usb-Klipper_lpc1768_0BA0FF02A99869AFEBF2415EC62000F5-if00
restart_method = command

[mcu rpi]
serial = /tmp/klipper_host_mcu

[adxl345]
cs_pin = rpi:None

[resonance_tester]
accel_chip = adxl345
probe_points = 
	165,165,20

[temperature_sensor Pi]
sensor_type = rpi_temperature
min_temp = 0
max_temp = 90

[temperature_sensor enclosure]
sensor_type = ATC Semitec 104GT-2
sensor_pin = P0.25

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_accel_to_decel = 3000
max_z_velocity = 25
max_z_accel = 30

[stepper_x]
step_pin = P2.2
dir_pin = !P2.3
enable_pin = !P2.1
rotation_distance = 40
endstop_pin = !P1.29
position_endstop = -19
position_min = -19
position_max = 311
homing_speed = 50
homing_retract_dist = 10
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_x]
uart_pin = P1.1
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_y]
step_pin = P0.19
dir_pin = P0.20
enable_pin = !P2.8
rotation_distance = 40
endstop_pin = !P1.27
position_endstop = -6
position_min = -6
position_max = 324
homing_retract_dist = 10
homing_speed = 50.0
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_y]
uart_pin = P1.8
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z]
step_pin = P1.9
dir_pin = !P1.14
enable_pin = !P0.10
rotation_distance = 8
microsteps = 16
endstop_pin = probe:z_virtual_endstop
position_max = 400
position_min = -10

[safe_z_home]
home_xy_position = 165,165
speed = 50
z_hop = 10
z_hop_speed = 5

[tmc2209 stepper_z]
uart_pin = P1.10
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z1]
step_pin = P0.22
dir_pin = !P2.11
enable_pin = !P0.21
rotation_distance = 8
microsteps = 16

[tmc2209 stepper_z1]
uart_pin = P1.17
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[z_tilt]
horizontal_move_z = 15
speed = 180
retries = 5
retry_tolerance = 0.01
z_positions = 
	50,165
	270,165
points = 
	10,165
	260,165

[extruder]
step_pin = P2.13
enable_pin = !P2.12
rotation_distance = 7.75
dir_pin = !P0.11
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = P2.7
sensor_type = PT1000
sensor_pin = P0.23
control = pid
pid_kp = 24.817
pid_ki = 1.157
pid_kd = 133.080
min_temp = 0
max_temp = 300
microsteps = 16
max_extrude_only_distance = 800.0

[tmc2209 extruder]
uart_pin = P1.15
interpolate = True
run_current = 0.500
hold_current = 0.500
sense_resistor = 0.110
stealthchop_threshold = 9999

[heater_bed]
heater_pin = P2.5
sensor_type = EPCOS 100K B57560G104F
sensor_pin = P0.24
control = pid
pid_kp = 54.027
pid_ki = 0.770
pid_kd = 948.182
min_temp = 0
max_temp = 130

[heater_fan hotend_fan]
pin = P1.4
heater = extruder
heater_temp = 50.0

[fan]
pin = P2.4
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 157, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 141, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/pi/klipper/klippy/klippy.py", line 130, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/pi/klipper/klippy/extras/temperature_sensor.py", line 42, in load_config_prefix
    return PrinterSensorGeneric(config)
  File "/home/pi/klipper/klippy/extras/temperature_sensor.py", line 14, in __init__
    self.sensor = pheaters.setup_sensor(config)
  File "/home/pi/klipper/klippy/extras/heaters.py", line 282, in setup_sensor
    "Unknown temperature sensor '%s'" % (sensor_type,))
Error: Unknown temperature sensor 'rpi_temperature'
webhooks client 3044998880: New connection
webhooks client 3044998880: Client info {'program': 'Moonraker', 'version': 'v0.7.1-194-geda5623'}
webhooks client 3044998880: Disconnected
Restarting printer
Start printer at Thu Dec  2 11:16:40 2021 (1638472600.5 2067.8)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro START_PRINT]
gcode = 
	CLEAR_PAUSE
	M117 Print Starting...
	M104 S{T_EXTRUDER}
	M140 S{T_BED}
	{% if printer.heater_bed.temperature < params.T_BED|float*0.95 %}
	M190 S{params.T_BED|float*0.95}
	{% endif %}
	M117 Homing All...
	G28
	G92 E0 ; Reset Extruder distance to 0
	G1 E-2 ; Retracts filament to prevent blobs during probing
	Z_TILT_ADJUST
	LEVEL_BED
	G90
	G92 E0
	SET_GCODE_OFFSET Z=0
	G1 X15 Y20 Z5 F6000
	M117 Waiting for Temps
	M190 S{T_BED}
	M109 S{T_EXTRUDER}
	PRIME_LINE
	M117 Printing.....

[gcode_macro END_PRINT]
gcode = 
	SAVE_GCODE_STATE NAME=end_print
	M117 Done printing
	G91
	G1 E-10 F3600
	G90
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < 100 %}
	{% set z_safe = 100.0 %}
	{% else %}
	{% set z_safe = 0 %}
	{% endif %}
	{% set x_max = printer.toolhead.axis_maximum.x|float - 3 %}
	{% set y_max = printer.toolhead.axis_maximum.y|float - 3 %}
	G1 X{x_max} Y{y_max} Z{z_safe} F2000
	M104 S0         ;Disable Hot End
	M140 S0         ;Disable Heat Bed
	RESTORE_GCODE_STATE NAME=end_print
	M84             ;Disable Steppers
	BED_MESH_CLEAR

[gcode_macro PRIME_LINE]
gcode = 
	M117 Prime Line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up
	G1 X0 Y30 Z2.28 F5000 ;Move to start position
	G1 X0 Y200.0 Z2.28 F500 E15 ;Draw the first line
	G1 X1 Y200.0 Z2.28 F5000 ;Move to side a little
	G1 X1 Y50 Z2.28 F500 E30 ;Draw the second line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up

[gcode_macro G29]
gcode = 
	G28
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE save=default

[gcode_macro LEVEL_BED]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro M204]
rename_existing = M204.1
default_parameter_f = 0.75
gcode = 
	{% if 'S' in params %}
	SET_VELOCITY_LIMIT ACCEL={ S } ACCEL_TO_DECEL={ S|float * F|float }
	{% endif %}
	{% if 'P' in params %}
	SET_VELOCITY_LIMIT ACCEL={ P } ACCEL_TO_DECEL={ P|float * F|float }
	{% endif %}

[gcode_macro M205]
gcode = 
	{% if 'X' in params %}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={ X }
	{% endif %}

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% if printer.extruder.target != 0 %}
	{% if printer.extruder.temperature < printer.extruder.target %}
	M117 Heating from {printer.extruder.temperature} to {printer.extruder.target}.
	M109 S{printer.extruder.target|float}
	{% endif %}
	{% else %}
	{% if printer.extruder.target < T %}
	M117 No setpoint, heating to {T}.
	M109 S{T}
	{% endif %}
	{% endif %}

[gcode_macro M600]
gcode = 
	PAUSE_MACRO
	UNLOAD

[gcode_macro M601]
gcode = 
	PAUSE_MACRO

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro PAUSE_MACRO]
gcode = 
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=bed_temp VALUE={printer.heater_bed.target}
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=extruder_temp VALUE={printer.extruder.target}
	M117 Parking...
	PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=28800
variable_bed_temp = 0
variable_extruder_temp = 0

[gcode_macro RESUME_MACRO]
gcode = 
	M117 Heating Back Up...
	M140 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M104 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	M190 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M109 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	SET_IDLE_TIMEOUT TIMEOUT=600
	M117  Resuming...
	RESUME

[gcode_macro LOAD]
gcode = 
	SAVE_GCODE_STATE NAME=loading_filament
	M83
	G92 E0.0
	G1 E10 F1000
	G1 E100 F200
	G92 E0.0
	RESTORE_GCODE_STATE NAME=loading_filament

[gcode_macro UNLOAD]
gcode = 
	SAVE_GCODE_STATE NAME=unloading_filament
	G91
	G1 E10 F100
	G92 E0.0
	G1 E-150 F1000
	G92 E0.0
	RESTORE_GCODE_STATE NAME=unloading_filament

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro TIMELAPSE_TAKE_FRAME]
gcode = 
	{action_call_remote_method("timelapse_newframe")}

[gcode_macro TIMELAPSE_RENDER]
gcode = 
	{action_call_remote_method("timelapse_render")}

[bed_screws]
screw1 = 5,5
screw2 = 165,5
screw3 = 325,5
screw4 = 5,325
screw5 = 165,325
screw6 = 325,325

[screws_tilt_adjust]
screw1 = 60,22
screw1_name = front left screw
screw2 = 205,10
screw2_name = front middle screw
screw3 = 350,25
screw3_name = front right screw
screw4 = 50,325
screw4_name = back left screw
screw5 = 205,325
screw5_name = back middle screw
screw6 = 350,325
screw6_name = back right screw
horizontal_move_z = 10
speed = 120
screw_thread = CW-M3

[bed_mesh]
speed = 120
probe_count = 7,7
horizontal_move_z = 15
algorithm = bicubic
mesh_min = 30,20
mesh_max = 300,300
mesh_pps = 0,0

[probe]
x_offset = 41.5
y_offset = 5.1
pin = P1.25
speed = 20
z_offset = 1.540

[input_shaper]
shaper_freq_x = 52.6
shaper_type_x = 2hump_ei
shaper_freq_y = 44.6
shaper_type_y = 2hump_ei

[virtual_sdcard]
path = ~/gcode_files

[mcu]
serial = /dev/serial/by-id/usb-Klipper_lpc1768_0BA0FF02A99869AFEBF2415EC62000F5-if00
restart_method = command

[mcu rpi]
serial = /tmp/klipper_host_mcu

[adxl345]
cs_pin = rpi:None

[resonance_tester]
accel_chip = adxl345
probe_points = 
	165,165,20

[temperature_sensor Pi]
sensor_type = rpi_temperature
min_temp = 0
max_temp = 90

[temperature_sensor enclosure]
sensor_type = ATC Semitec 104GT-2
sensor_pin = P0.25

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_accel_to_decel = 3000
max_z_velocity = 25
max_z_accel = 30

[stepper_x]
step_pin = P2.2
dir_pin = !P2.3
enable_pin = !P2.1
rotation_distance = 40
endstop_pin = !P1.29
position_endstop = -19
position_min = -19
position_max = 311
homing_speed = 50
homing_retract_dist = 10
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_x]
uart_pin = P1.1
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_y]
step_pin = P0.19
dir_pin = P0.20
enable_pin = !P2.8
rotation_distance = 40
endstop_pin = !P1.27
position_endstop = -6
position_min = -6
position_max = 324
homing_retract_dist = 10
homing_speed = 50.0
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_y]
uart_pin = P1.8
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z]
step_pin = P1.9
dir_pin = !P1.14
enable_pin = !P0.10
rotation_distance = 8
microsteps = 16
endstop_pin = probe:z_virtual_endstop
position_max = 400
position_min = -10

[safe_z_home]
home_xy_position = 165,165
speed = 50
z_hop = 10
z_hop_speed = 5

[tmc2209 stepper_z]
uart_pin = P1.10
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z1]
step_pin = P0.22
dir_pin = !P2.11
enable_pin = !P0.21
rotation_distance = 8
microsteps = 16

[tmc2209 stepper_z1]
uart_pin = P1.17
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[z_tilt]
horizontal_move_z = 15
speed = 180
retries = 5
retry_tolerance = 0.01
z_positions = 
	50,165
	270,165
points = 
	10,165
	260,165

[extruder]
step_pin = P2.13
enable_pin = !P2.12
rotation_distance = 7.75
dir_pin = !P0.11
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = P2.7
sensor_type = PT1000
sensor_pin = P0.23
control = pid
pid_kp = 24.817
pid_ki = 1.157
pid_kd = 133.080
min_temp = 0
max_temp = 300
microsteps = 16
max_extrude_only_distance = 800.0

[tmc2209 extruder]
uart_pin = P1.15
interpolate = True
run_current = 0.500
hold_current = 0.500
sense_resistor = 0.110
stealthchop_threshold = 9999

[heater_bed]
heater_pin = P2.5
sensor_type = EPCOS 100K B57560G104F
sensor_pin = P0.24
control = pid
pid_kp = 54.027
pid_ki = 0.770
pid_kd = 948.182
min_temp = 0
max_temp = 130

[heater_fan hotend_fan]
pin = P1.4
heater = extruder
heater_temp = 50.0

[fan]
pin = P2.4
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 157, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 141, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/pi/klipper/klippy/klippy.py", line 130, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/pi/klipper/klippy/extras/temperature_sensor.py", line 42, in load_config_prefix
    return PrinterSensorGeneric(config)
  File "/home/pi/klipper/klippy/extras/temperature_sensor.py", line 14, in __init__
    self.sensor = pheaters.setup_sensor(config)
  File "/home/pi/klipper/klippy/extras/heaters.py", line 282, in setup_sensor
    "Unknown temperature sensor '%s'" % (sensor_type,))
Error: Unknown temperature sensor 'rpi_temperature'
webhooks client 3042070240: New connection
webhooks client 3042070240: Client info {'program': 'Moonraker', 'version': 'v0.7.1-194-geda5623'}
webhooks client 3042070240: Disconnected
Restarting printer
Start printer at Thu Dec  2 11:18:13 2021 (1638472693.9 2161.2)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro START_PRINT]
gcode = 
	CLEAR_PAUSE
	M117 Print Starting...
	M104 S{T_EXTRUDER}
	M140 S{T_BED}
	{% if printer.heater_bed.temperature < params.T_BED|float*0.95 %}
	M190 S{params.T_BED|float*0.95}
	{% endif %}
	M117 Homing All...
	G28
	G92 E0 ; Reset Extruder distance to 0
	G1 E-2 ; Retracts filament to prevent blobs during probing
	Z_TILT_ADJUST
	LEVEL_BED
	G90
	G92 E0
	SET_GCODE_OFFSET Z=0
	G1 X15 Y20 Z5 F6000
	M117 Waiting for Temps
	M190 S{T_BED}
	M109 S{T_EXTRUDER}
	PRIME_LINE
	M117 Printing.....

[gcode_macro END_PRINT]
gcode = 
	SAVE_GCODE_STATE NAME=end_print
	M117 Done printing
	G91
	G1 E-10 F3600
	G90
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < 100 %}
	{% set z_safe = 100.0 %}
	{% else %}
	{% set z_safe = 0 %}
	{% endif %}
	{% set x_max = printer.toolhead.axis_maximum.x|float - 3 %}
	{% set y_max = printer.toolhead.axis_maximum.y|float - 3 %}
	G1 X{x_max} Y{y_max} Z{z_safe} F2000
	M104 S0         ;Disable Hot End
	M140 S0         ;Disable Heat Bed
	RESTORE_GCODE_STATE NAME=end_print
	M84             ;Disable Steppers
	BED_MESH_CLEAR

[gcode_macro PRIME_LINE]
gcode = 
	M117 Prime Line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up
	G1 X0 Y30 Z2.28 F5000 ;Move to start position
	G1 X0 Y200.0 Z2.28 F500 E15 ;Draw the first line
	G1 X1 Y200.0 Z2.28 F5000 ;Move to side a little
	G1 X1 Y50 Z2.28 F500 E30 ;Draw the second line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up

[gcode_macro G29]
gcode = 
	G28
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE save=default

[gcode_macro LEVEL_BED]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro M204]
rename_existing = M204.1
default_parameter_f = 0.75
gcode = 
	{% if 'S' in params %}
	SET_VELOCITY_LIMIT ACCEL={ S } ACCEL_TO_DECEL={ S|float * F|float }
	{% endif %}
	{% if 'P' in params %}
	SET_VELOCITY_LIMIT ACCEL={ P } ACCEL_TO_DECEL={ P|float * F|float }
	{% endif %}

[gcode_macro M205]
gcode = 
	{% if 'X' in params %}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={ X }
	{% endif %}

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% if printer.extruder.target != 0 %}
	{% if printer.extruder.temperature < printer.extruder.target %}
	M117 Heating from {printer.extruder.temperature} to {printer.extruder.target}.
	M109 S{printer.extruder.target|float}
	{% endif %}
	{% else %}
	{% if printer.extruder.target < T %}
	M117 No setpoint, heating to {T}.
	M109 S{T}
	{% endif %}
	{% endif %}

[gcode_macro M600]
gcode = 
	PAUSE_MACRO
	UNLOAD

[gcode_macro M601]
gcode = 
	PAUSE_MACRO

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro PAUSE_MACRO]
gcode = 
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=bed_temp VALUE={printer.heater_bed.target}
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=extruder_temp VALUE={printer.extruder.target}
	M117 Parking...
	PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=28800
variable_bed_temp = 0
variable_extruder_temp = 0

[gcode_macro RESUME_MACRO]
gcode = 
	M117 Heating Back Up...
	M140 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M104 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	M190 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M109 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	SET_IDLE_TIMEOUT TIMEOUT=600
	M117  Resuming...
	RESUME

[gcode_macro LOAD]
gcode = 
	SAVE_GCODE_STATE NAME=loading_filament
	M83
	G92 E0.0
	G1 E10 F1000
	G1 E100 F200
	G92 E0.0
	RESTORE_GCODE_STATE NAME=loading_filament

[gcode_macro UNLOAD]
gcode = 
	SAVE_GCODE_STATE NAME=unloading_filament
	G91
	G1 E10 F100
	G92 E0.0
	G1 E-150 F1000
	G92 E0.0
	RESTORE_GCODE_STATE NAME=unloading_filament

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro TIMELAPSE_TAKE_FRAME]
gcode = 
	{action_call_remote_method("timelapse_newframe")}

[gcode_macro TIMELAPSE_RENDER]
gcode = 
	{action_call_remote_method("timelapse_render")}

[bed_screws]
screw1 = 5,5
screw2 = 165,5
screw3 = 325,5
screw4 = 5,325
screw5 = 165,325
screw6 = 325,325

[screws_tilt_adjust]
screw1 = 60,22
screw1_name = front left screw
screw2 = 205,10
screw2_name = front middle screw
screw3 = 350,25
screw3_name = front right screw
screw4 = 50,325
screw4_name = back left screw
screw5 = 205,325
screw5_name = back middle screw
screw6 = 350,325
screw6_name = back right screw
horizontal_move_z = 10
speed = 120
screw_thread = CW-M3

[bed_mesh]
speed = 120
probe_count = 7,7
horizontal_move_z = 15
algorithm = bicubic
mesh_min = 30,20
mesh_max = 300,300
mesh_pps = 0,0

[probe]
x_offset = 41.5
y_offset = 5.1
pin = P1.25
speed = 20
z_offset = 1.540

[input_shaper]
shaper_freq_x = 52.6
shaper_type_x = 2hump_ei
shaper_freq_y = 44.6
shaper_type_y = 2hump_ei

[virtual_sdcard]
path = ~/gcode_files

[mcu]
serial = /dev/serial/by-id/usb-Klipper_lpc1768_0BA0FF02A99869AFEBF2415EC62000F5-if00
restart_method = command

[mcu rpi]
serial = /tmp/klipper_host_mcu

[adxl345]
cs_pin = rpi:None

[resonance_tester]
accel_chip = adxl345
probe_points = 
	165,165,20

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 90

[temperature_sensor enclosure]
sensor_type = ATC Semitec 104GT-2
sensor_pin = P0.25

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_accel_to_decel = 3000
max_z_velocity = 25
max_z_accel = 30

[stepper_x]
step_pin = P2.2
dir_pin = !P2.3
enable_pin = !P2.1
rotation_distance = 40
endstop_pin = !P1.29
position_endstop = -19
position_min = -19
position_max = 311
homing_speed = 50
homing_retract_dist = 10
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_x]
uart_pin = P1.1
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_y]
step_pin = P0.19
dir_pin = P0.20
enable_pin = !P2.8
rotation_distance = 40
endstop_pin = !P1.27
position_endstop = -6
position_min = -6
position_max = 324
homing_retract_dist = 10
homing_speed = 50.0
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_y]
uart_pin = P1.8
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z]
step_pin = P1.9
dir_pin = !P1.14
enable_pin = !P0.10
rotation_distance = 8
microsteps = 16
endstop_pin = probe:z_virtual_endstop
position_max = 400
position_min = -10

[safe_z_home]
home_xy_position = 165,165
speed = 50
z_hop = 10
z_hop_speed = 5

[tmc2209 stepper_z]
uart_pin = P1.10
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z1]
step_pin = P0.22
dir_pin = !P2.11
enable_pin = !P0.21
rotation_distance = 8
microsteps = 16

[tmc2209 stepper_z1]
uart_pin = P1.17
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[z_tilt]
horizontal_move_z = 15
speed = 180
retries = 5
retry_tolerance = 0.01
z_positions = 
	50,165
	270,165
points = 
	10,165
	260,165

[extruder]
step_pin = P2.13
enable_pin = !P2.12
rotation_distance = 7.75
dir_pin = !P0.11
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = P2.7
sensor_type = PT1000
sensor_pin = P0.23
control = pid
pid_kp = 24.817
pid_ki = 1.157
pid_kd = 133.080
min_temp = 0
max_temp = 300
microsteps = 16
max_extrude_only_distance = 800.0

[tmc2209 extruder]
uart_pin = P1.15
interpolate = True
run_current = 0.500
hold_current = 0.500
sense_resistor = 0.110
stealthchop_threshold = 9999

[heater_bed]
heater_pin = P2.5
sensor_type = EPCOS 100K B57560G104F
sensor_pin = P0.24
control = pid
pid_kp = 54.027
pid_ki = 0.770
pid_kd = 948.182
min_temp = 0
max_temp = 130

[heater_fan hotend_fan]
pin = P1.4
heater = extruder
heater_temp = 50.0

[fan]
pin = P2.4
=======================
Extruder max_extrude_ratio=0.266081
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 157, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 145, in _read_config
    pconfig.check_unused_options(config)
  File "/home/pi/klipper/klippy/configfile.py", line 300, in check_unused_options
    % (option, section))
Error: Option 'default_parameter_f' is not valid in section 'gcode_macro m204'
webhooks client 3045822336: New connection
webhooks client 3045822336: Client info {'program': 'Moonraker', 'version': 'v0.7.1-194-geda5623'}
webhooks client 3045822336: Disconnected
Restarting printer
Start printer at Thu Dec  2 11:19:02 2021 (1638472742.4 2209.7)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro START_PRINT]
gcode = 
	CLEAR_PAUSE
	M117 Print Starting...
	M104 S{T_EXTRUDER}
	M140 S{T_BED}
	{% if printer.heater_bed.temperature < params.T_BED|float*0.95 %}
	M190 S{params.T_BED|float*0.95}
	{% endif %}
	M117 Homing All...
	G28
	G92 E0 ; Reset Extruder distance to 0
	G1 E-2 ; Retracts filament to prevent blobs during probing
	Z_TILT_ADJUST
	LEVEL_BED
	G90
	G92 E0
	SET_GCODE_OFFSET Z=0
	G1 X15 Y20 Z5 F6000
	M117 Waiting for Temps
	M190 S{T_BED}
	M109 S{T_EXTRUDER}
	PRIME_LINE
	M117 Printing.....

[gcode_macro END_PRINT]
gcode = 
	SAVE_GCODE_STATE NAME=end_print
	M117 Done printing
	G91
	G1 E-10 F3600
	G90
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < 100 %}
	{% set z_safe = 100.0 %}
	{% else %}
	{% set z_safe = 0 %}
	{% endif %}
	{% set x_max = printer.toolhead.axis_maximum.x|float - 3 %}
	{% set y_max = printer.toolhead.axis_maximum.y|float - 3 %}
	G1 X{x_max} Y{y_max} Z{z_safe} F2000
	M104 S0         ;Disable Hot End
	M140 S0         ;Disable Heat Bed
	RESTORE_GCODE_STATE NAME=end_print
	M84             ;Disable Steppers
	BED_MESH_CLEAR

[gcode_macro PRIME_LINE]
gcode = 
	M117 Prime Line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up
	G1 X0 Y30 Z2.28 F5000 ;Move to start position
	G1 X0 Y200.0 Z2.28 F500 E15 ;Draw the first line
	G1 X1 Y200.0 Z2.28 F5000 ;Move to side a little
	G1 X1 Y50 Z2.28 F500 E30 ;Draw the second line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up

[gcode_macro G29]
gcode = 
	G28
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE save=default

[gcode_macro LEVEL_BED]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro M205]
gcode = 
	{% if 'X' in params %}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={ X }
	{% endif %}

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% if printer.extruder.target != 0 %}
	{% if printer.extruder.temperature < printer.extruder.target %}
	M117 Heating from {printer.extruder.temperature} to {printer.extruder.target}.
	M109 S{printer.extruder.target|float}
	{% endif %}
	{% else %}
	{% if printer.extruder.target < T %}
	M117 No setpoint, heating to {T}.
	M109 S{T}
	{% endif %}
	{% endif %}

[gcode_macro M600]
gcode = 
	PAUSE_MACRO
	UNLOAD

[gcode_macro M601]
gcode = 
	PAUSE_MACRO

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro PAUSE_MACRO]
gcode = 
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=bed_temp VALUE={printer.heater_bed.target}
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=extruder_temp VALUE={printer.extruder.target}
	M117 Parking...
	PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=28800
variable_bed_temp = 0
variable_extruder_temp = 0

[gcode_macro RESUME_MACRO]
gcode = 
	M117 Heating Back Up...
	M140 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M104 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	M190 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M109 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	SET_IDLE_TIMEOUT TIMEOUT=600
	M117  Resuming...
	RESUME

[gcode_macro LOAD]
gcode = 
	SAVE_GCODE_STATE NAME=loading_filament
	M83
	G92 E0.0
	G1 E10 F1000
	G1 E100 F200
	G92 E0.0
	RESTORE_GCODE_STATE NAME=loading_filament

[gcode_macro UNLOAD]
gcode = 
	SAVE_GCODE_STATE NAME=unloading_filament
	G91
	G1 E10 F100
	G92 E0.0
	G1 E-150 F1000
	G92 E0.0
	RESTORE_GCODE_STATE NAME=unloading_filament

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro TIMELAPSE_TAKE_FRAME]
gcode = 
	{action_call_remote_method("timelapse_newframe")}

[gcode_macro TIMELAPSE_RENDER]
gcode = 
	{action_call_remote_method("timelapse_render")}

[bed_screws]
screw1 = 5,5
screw2 = 165,5
screw3 = 325,5
screw4 = 5,325
screw5 = 165,325
screw6 = 325,325

[screws_tilt_adjust]
screw1 = 60,22
screw1_name = front left screw
screw2 = 205,10
screw2_name = front middle screw
screw3 = 350,25
screw3_name = front right screw
screw4 = 50,325
screw4_name = back left screw
screw5 = 205,325
screw5_name = back middle screw
screw6 = 350,325
screw6_name = back right screw
horizontal_move_z = 10
speed = 120
screw_thread = CW-M3

[bed_mesh]
speed = 120
probe_count = 7,7
horizontal_move_z = 15
algorithm = bicubic
mesh_min = 30,20
mesh_max = 300,300
mesh_pps = 0,0

[probe]
x_offset = 41.5
y_offset = 5.1
pin = P1.25
speed = 20
z_offset = 1.540

[input_shaper]
shaper_freq_x = 52.6
shaper_type_x = 2hump_ei
shaper_freq_y = 44.6
shaper_type_y = 2hump_ei

[virtual_sdcard]
path = ~/gcode_files

[mcu]
serial = /dev/serial/by-id/usb-Klipper_lpc1768_0BA0FF02A99869AFEBF2415EC62000F5-if00
restart_method = command

[mcu rpi]
serial = /tmp/klipper_host_mcu

[adxl345]
cs_pin = rpi:None

[resonance_tester]
accel_chip = adxl345
probe_points = 
	165,165,20

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 90

[temperature_sensor enclosure]
sensor_type = ATC Semitec 104GT-2
sensor_pin = P0.25

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_accel_to_decel = 3000
max_z_velocity = 25
max_z_accel = 30

[stepper_x]
step_pin = P2.2
dir_pin = !P2.3
enable_pin = !P2.1
rotation_distance = 40
endstop_pin = !P1.29
position_endstop = -19
position_min = -19
position_max = 311
homing_speed = 50
homing_retract_dist = 10
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_x]
uart_pin = P1.1
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_y]
step_pin = P0.19
dir_pin = P0.20
enable_pin = !P2.8
rotation_distance = 40
endstop_pin = !P1.27
position_endstop = -6
position_min = -6
position_max = 324
homing_retract_dist = 10
homing_speed = 50.0
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_y]
uart_pin = P1.8
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z]
step_pin = P1.9
dir_pin = !P1.14
enable_pin = !P0.10
rotation_distance = 8
microsteps = 16
endstop_pin = probe:z_virtual_endstop
position_max = 400
position_min = -10

[safe_z_home]
home_xy_position = 165,165
speed = 50
z_hop = 10
z_hop_speed = 5

[tmc2209 stepper_z]
uart_pin = P1.10
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z1]
step_pin = P0.22
dir_pin = !P2.11
enable_pin = !P0.21
rotation_distance = 8
microsteps = 16

[tmc2209 stepper_z1]
uart_pin = P1.17
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[z_tilt]
horizontal_move_z = 15
speed = 180
retries = 5
retry_tolerance = 0.01
z_positions = 
	50,165
	270,165
points = 
	10,165
	260,165

[extruder]
step_pin = P2.13
enable_pin = !P2.12
rotation_distance = 7.75
dir_pin = !P0.11
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = P2.7
sensor_type = PT1000
sensor_pin = P0.23
control = pid
pid_kp = 24.817
pid_ki = 1.157
pid_kd = 133.080
min_temp = 0
max_temp = 300
microsteps = 16
max_extrude_only_distance = 800.0

[tmc2209 extruder]
uart_pin = P1.15
interpolate = True
run_current = 0.500
hold_current = 0.500
sense_resistor = 0.110
stealthchop_threshold = 9999

[heater_bed]
heater_pin = P2.5
sensor_type = EPCOS 100K B57560G104F
sensor_pin = P0.24
control = pid
pid_kp = 54.027
pid_ki = 0.770
pid_kd = 948.182
min_temp = 0
max_temp = 130

[heater_fan hotend_fan]
pin = P1.4
heater = extruder
heater_temp = 50.0

[fan]
pin = P2.4
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 3041726552: New connection
webhooks client 3041726552: Client info {'program': 'Moonraker', 'version': 'v0.7.1-194-geda5623'}
Loaded MCU 'mcu' 94 commands (v0.10.0-171-g8b2da0d3 / gcc: (15:7-2018-q2-6) 7.3.1 20180622 (release) [ARM/embedded-7-branch revision 261907] binutils: (2.31.1-11+rpi1+11) 2.31.1)
MCU 'mcu' config: BUS_PINS_i2c1=P0.1,P0.0 BUS_PINS_i2c0=P0.28,P0.27 BUS_PINS_i2c2=P0.11,P0.10 BUS_PINS_i2c1a=P0.20,P0.19 BUS_PINS_ssp1=P0.8,P0.9,P0.7 STEPPER_BOTH_EDGE=1 ADC_MAX=4095 BUS_PINS_ssp0=P0.17,P0.18,P0.15 PWM_MAX=255 CLOCK_FREQ=100000000 RESERVE_PINS_USB=P0.30,P0.29,P2.9 MCU=lpc1768 STATS_SUMSQ_BASE=256
mcu 'rpi': Starting connect
Loaded MCU 'rpi' 101 commands (v0.9.1-616-g28f60f7e / gcc: (Raspbian 8.3.0-6+rpi1) 8.3.0 binutils: (GNU Binutils for Raspbian) 2.31.1)
MCU 'rpi' config: PCA9685_MAX=4096 ADC_MAX=4095 PWM_MAX=32768 CLOCK_FREQ=50000000 STEP_DELAY=2 MCU=linux STATS_SUMSQ_BASE=256
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Protocol error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 162, in _connect
    cb()
  File "/home/pi/klipper/klippy/mcu.py", line 723, in _connect
    config_params = self._send_get_config()
  File "/home/pi/klipper/klippy/mcu.py", line 701, in _send_get_config
    "config is_config=%c crc=%u is_shutdown=%c move_count=%hu")
  File "/home/pi/klipper/klippy/mcu.py", line 849, in lookup_query_command
    cq, is_async, self._printer.command_error)
  File "/home/pi/klipper/klippy/mcu.py", line 497, in __init__
    serial.get_msgparser().lookup_command(respformat)
  File "/home/pi/klipper/klippy/msgproto.py", line 319, in lookup_command
    msgformat, mp.msgformat)
  File "/home/pi/klipper/klippy/msgproto.py", line 244, in _error
    raise error(self.warn_prefix + (msg % params))
error: mcu 'rpi': Command format mismatch: config is_config=%c crc=%u is_shutdown=%c move_count=%hu vs config is_config=%c crc=%u move_count=%hu is_shutdown=%c
Build file /home/pi/klipper/klippy/../.config(1080): Thu Dec  2 11:15:25 2021
========= Last MCU build config =========
# CONFIG_LOW_LEVEL_OPTIONS is not set
# CONFIG_MACH_AVR is not set
# CONFIG_MACH_ATSAM is not set
# CONFIG_MACH_ATSAMD is not set
CONFIG_MACH_LPC176X=y
# CONFIG_MACH_STM32 is not set
# CONFIG_MACH_RP2040 is not set
# CONFIG_MACH_PRU is not set
# CONFIG_MACH_LINUX is not set
# CONFIG_MACH_SIMU is not set
CONFIG_BOARD_DIRECTORY="lpc176x"
CONFIG_MCU="lpc1768"
CONFIG_CLOCK_FREQ=100000000
CONFIG_USBSERIAL=y
CONFIG_FLASH_START=0x4000
CONFIG_FLASH_SIZE=0x80000
CONFIG_RAM_START=0x10000000
CONFIG_RAM_SIZE=0x7fe0
CONFIG_STACK_SIZE=512
CONFIG_LPC_SELECT=y
CONFIG_MACH_LPC1768=y
# CONFIG_MACH_LPC1769 is not set
CONFIG_SMOOTHIEWARE_BOOTLOADER=y
CONFIG_LPC_USB=y
# CONFIG_LPC_SERIAL_UART0_P03_P02 is not set
CONFIG_USB_VENDOR_ID=0x1d50
CONFIG_USB_DEVICE_ID=0x614e
CONFIG_USB_SERIAL_NUMBER_CHIPID=y
CONFIG_USB_SERIAL_NUMBER="12345"
CONFIG_HAVE_GPIO=y
CONFIG_HAVE_GPIO_ADC=y
CONFIG_HAVE_GPIO_SPI=y
CONFIG_HAVE_GPIO_I2C=y
CONFIG_HAVE_GPIO_HARD_PWM=y
CONFIG_HAVE_GPIO_BITBANGING=y
CONFIG_HAVE_STRICT_TIMING=y
CONFIG_HAVE_CHIPID=y
CONFIG_HAVE_STEPPER_BOTH_EDGE=y
CONFIG_INLINE_STEPPER_HACK=y
=======================
Build file /home/pi/klipper/klippy/../out/klipper.dict(6738): Thu Dec  2 11:15:37 2021
Last MCU build version: v0.10.0-171-g8b2da0d3
Last MCU build tools: gcc: (15:7-2018-q2-6) 7.3.1 20180622 (release) [ARM/embedded-7-branch revision 261907] binutils: (2.31.1-11+rpi1+11) 2.31.1
Last MCU build config: BUS_PINS_i2c1=P0.1,P0.0 BUS_PINS_i2c0=P0.28,P0.27 BUS_PINS_i2c2=P0.11,P0.10 BUS_PINS_i2c1a=P0.20,P0.19 BUS_PINS_ssp1=P0.8,P0.9,P0.7 STEPPER_BOTH_EDGE=1 ADC_MAX=4095 BUS_PINS_ssp0=P0.17,P0.18,P0.15 PWM_MAX=255 CLOCK_FREQ=100000000 RESERVE_PINS_USB=P0.30,P0.29,P2.9 MCU=lpc1768 STATS_SUMSQ_BASE=256
Build file /home/pi/klipper/klippy/../out/klipper.elf(274504): Thu Dec  2 11:15:42 2021
Attempting MCU 'mcu' reset command
Attempting MCU 'rpi' config_reset command
Got EOF when reading from device
webhooks client 3041726552: Disconnected
Restarting printer
Start printer at Thu Dec  2 11:19:14 2021 (1638472754.6 2222.0)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro START_PRINT]
gcode = 
	CLEAR_PAUSE
	M117 Print Starting...
	M104 S{T_EXTRUDER}
	M140 S{T_BED}
	{% if printer.heater_bed.temperature < params.T_BED|float*0.95 %}
	M190 S{params.T_BED|float*0.95}
	{% endif %}
	M117 Homing All...
	G28
	G92 E0 ; Reset Extruder distance to 0
	G1 E-2 ; Retracts filament to prevent blobs during probing
	Z_TILT_ADJUST
	LEVEL_BED
	G90
	G92 E0
	SET_GCODE_OFFSET Z=0
	G1 X15 Y20 Z5 F6000
	M117 Waiting for Temps
	M190 S{T_BED}
	M109 S{T_EXTRUDER}
	PRIME_LINE
	M117 Printing.....

[gcode_macro END_PRINT]
gcode = 
	SAVE_GCODE_STATE NAME=end_print
	M117 Done printing
	G91
	G1 E-10 F3600
	G90
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < 100 %}
	{% set z_safe = 100.0 %}
	{% else %}
	{% set z_safe = 0 %}
	{% endif %}
	{% set x_max = printer.toolhead.axis_maximum.x|float - 3 %}
	{% set y_max = printer.toolhead.axis_maximum.y|float - 3 %}
	G1 X{x_max} Y{y_max} Z{z_safe} F2000
	M104 S0         ;Disable Hot End
	M140 S0         ;Disable Heat Bed
	RESTORE_GCODE_STATE NAME=end_print
	M84             ;Disable Steppers
	BED_MESH_CLEAR

[gcode_macro PRIME_LINE]
gcode = 
	M117 Prime Line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up
	G1 X0 Y30 Z2.28 F5000 ;Move to start position
	G1 X0 Y200.0 Z2.28 F500 E15 ;Draw the first line
	G1 X1 Y200.0 Z2.28 F5000 ;Move to side a little
	G1 X1 Y50 Z2.28 F500 E30 ;Draw the second line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up

[gcode_macro G29]
gcode = 
	G28
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE save=default

[gcode_macro LEVEL_BED]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro M205]
gcode = 
	{% if 'X' in params %}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={ X }
	{% endif %}

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% if printer.extruder.target != 0 %}
	{% if printer.extruder.temperature < printer.extruder.target %}
	M117 Heating from {printer.extruder.temperature} to {printer.extruder.target}.
	M109 S{printer.extruder.target|float}
	{% endif %}
	{% else %}
	{% if printer.extruder.target < T %}
	M117 No setpoint, heating to {T}.
	M109 S{T}
	{% endif %}
	{% endif %}

[gcode_macro M600]
gcode = 
	PAUSE_MACRO
	UNLOAD

[gcode_macro M601]
gcode = 
	PAUSE_MACRO

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro PAUSE_MACRO]
gcode = 
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=bed_temp VALUE={printer.heater_bed.target}
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=extruder_temp VALUE={printer.extruder.target}
	M117 Parking...
	PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=28800
variable_bed_temp = 0
variable_extruder_temp = 0

[gcode_macro RESUME_MACRO]
gcode = 
	M117 Heating Back Up...
	M140 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M104 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	M190 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M109 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	SET_IDLE_TIMEOUT TIMEOUT=600
	M117  Resuming...
	RESUME

[gcode_macro LOAD]
gcode = 
	SAVE_GCODE_STATE NAME=loading_filament
	M83
	G92 E0.0
	G1 E10 F1000
	G1 E100 F200
	G92 E0.0
	RESTORE_GCODE_STATE NAME=loading_filament

[gcode_macro UNLOAD]
gcode = 
	SAVE_GCODE_STATE NAME=unloading_filament
	G91
	G1 E10 F100
	G92 E0.0
	G1 E-150 F1000
	G92 E0.0
	RESTORE_GCODE_STATE NAME=unloading_filament

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro TIMELAPSE_TAKE_FRAME]
gcode = 
	{action_call_remote_method("timelapse_newframe")}

[gcode_macro TIMELAPSE_RENDER]
gcode = 
	{action_call_remote_method("timelapse_render")}

[bed_screws]
screw1 = 5,5
screw2 = 165,5
screw3 = 325,5
screw4 = 5,325
screw5 = 165,325
screw6 = 325,325

[screws_tilt_adjust]
screw1 = 60,22
screw1_name = front left screw
screw2 = 205,10
screw2_name = front middle screw
screw3 = 350,25
screw3_name = front right screw
screw4 = 50,325
screw4_name = back left screw
screw5 = 205,325
screw5_name = back middle screw
screw6 = 350,325
screw6_name = back right screw
horizontal_move_z = 10
speed = 120
screw_thread = CW-M3

[bed_mesh]
speed = 120
probe_count = 7,7
horizontal_move_z = 15
algorithm = bicubic
mesh_min = 30,20
mesh_max = 300,300
mesh_pps = 0,0

[probe]
x_offset = 41.5
y_offset = 5.1
pin = P1.25
speed = 20
z_offset = 1.540

[input_shaper]
shaper_freq_x = 52.6
shaper_type_x = 2hump_ei
shaper_freq_y = 44.6
shaper_type_y = 2hump_ei

[virtual_sdcard]
path = ~/gcode_files

[mcu]
serial = /dev/serial/by-id/usb-Klipper_lpc1768_0BA0FF02A99869AFEBF2415EC62000F5-if00
restart_method = command

[mcu rpi]
serial = /tmp/klipper_host_mcu

[adxl345]
cs_pin = rpi:None

[resonance_tester]
accel_chip = adxl345
probe_points = 
	165,165,20

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 90

[temperature_sensor enclosure]
sensor_type = ATC Semitec 104GT-2
sensor_pin = P0.25

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_accel_to_decel = 3000
max_z_velocity = 25
max_z_accel = 30

[stepper_x]
step_pin = P2.2
dir_pin = !P2.3
enable_pin = !P2.1
rotation_distance = 40
endstop_pin = !P1.29
position_endstop = -19
position_min = -19
position_max = 311
homing_speed = 50
homing_retract_dist = 10
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_x]
uart_pin = P1.1
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_y]
step_pin = P0.19
dir_pin = P0.20
enable_pin = !P2.8
rotation_distance = 40
endstop_pin = !P1.27
position_endstop = -6
position_min = -6
position_max = 324
homing_retract_dist = 10
homing_speed = 50.0
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_y]
uart_pin = P1.8
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z]
step_pin = P1.9
dir_pin = !P1.14
enable_pin = !P0.10
rotation_distance = 8
microsteps = 16
endstop_pin = probe:z_virtual_endstop
position_max = 400
position_min = -10

[safe_z_home]
home_xy_position = 165,165
speed = 50
z_hop = 10
z_hop_speed = 5

[tmc2209 stepper_z]
uart_pin = P1.10
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z1]
step_pin = P0.22
dir_pin = !P2.11
enable_pin = !P0.21
rotation_distance = 8
microsteps = 16

[tmc2209 stepper_z1]
uart_pin = P1.17
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[z_tilt]
horizontal_move_z = 15
speed = 180
retries = 5
retry_tolerance = 0.01
z_positions = 
	50,165
	270,165
points = 
	10,165
	260,165

[extruder]
step_pin = P2.13
enable_pin = !P2.12
rotation_distance = 7.75
dir_pin = !P0.11
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = P2.7
sensor_type = PT1000
sensor_pin = P0.23
control = pid
pid_kp = 24.817
pid_ki = 1.157
pid_kd = 133.080
min_temp = 0
max_temp = 300
microsteps = 16
max_extrude_only_distance = 800.0

[tmc2209 extruder]
uart_pin = P1.15
interpolate = True
run_current = 0.500
hold_current = 0.500
sense_resistor = 0.110
stealthchop_threshold = 9999

[heater_bed]
heater_pin = P2.5
sensor_type = EPCOS 100K B57560G104F
sensor_pin = P0.24
control = pid
pid_kp = 54.027
pid_ki = 0.770
pid_kd = 948.182
min_temp = 0
max_temp = 130

[heater_fan hotend_fan]
pin = P1.4
heater = extruder
heater_temp = 50.0

[fan]
pin = P2.4
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 3042157872: New connection
webhooks client 3042157872: Client info {'program': 'Moonraker', 'version': 'v0.7.1-194-geda5623'}
Loaded MCU 'mcu' 94 commands (v0.10.0-171-g8b2da0d3 / gcc: (15:7-2018-q2-6) 7.3.1 20180622 (release) [ARM/embedded-7-branch revision 261907] binutils: (2.31.1-11+rpi1+11) 2.31.1)
MCU 'mcu' config: BUS_PINS_i2c1=P0.1,P0.0 BUS_PINS_i2c0=P0.28,P0.27 BUS_PINS_i2c2=P0.11,P0.10 BUS_PINS_i2c1a=P0.20,P0.19 BUS_PINS_ssp1=P0.8,P0.9,P0.7 STEPPER_BOTH_EDGE=1 ADC_MAX=4095 BUS_PINS_ssp0=P0.17,P0.18,P0.15 PWM_MAX=255 CLOCK_FREQ=100000000 RESERVE_PINS_USB=P0.30,P0.29,P2.9 MCU=lpc1768 STATS_SUMSQ_BASE=256
mcu 'rpi': Starting connect
Loaded MCU 'rpi' 101 commands (v0.9.1-616-g28f60f7e / gcc: (Raspbian 8.3.0-6+rpi1) 8.3.0 binutils: (GNU Binutils for Raspbian) 2.31.1)
MCU 'rpi' config: PCA9685_MAX=4096 ADC_MAX=4095 PWM_MAX=32768 CLOCK_FREQ=50000000 STEP_DELAY=2 MCU=linux STATS_SUMSQ_BASE=256
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Protocol error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 162, in _connect
    cb()
  File "/home/pi/klipper/klippy/mcu.py", line 723, in _connect
    config_params = self._send_get_config()
  File "/home/pi/klipper/klippy/mcu.py", line 701, in _send_get_config
    "config is_config=%c crc=%u is_shutdown=%c move_count=%hu")
  File "/home/pi/klipper/klippy/mcu.py", line 849, in lookup_query_command
    cq, is_async, self._printer.command_error)
  File "/home/pi/klipper/klippy/mcu.py", line 497, in __init__
    serial.get_msgparser().lookup_command(respformat)
  File "/home/pi/klipper/klippy/msgproto.py", line 319, in lookup_command
    msgformat, mp.msgformat)
  File "/home/pi/klipper/klippy/msgproto.py", line 244, in _error
    raise error(self.warn_prefix + (msg % params))
error: mcu 'rpi': Command format mismatch: config is_config=%c crc=%u is_shutdown=%c move_count=%hu vs config is_config=%c crc=%u move_count=%hu is_shutdown=%c
Build file /home/pi/klipper/klippy/../.config(1080): Thu Dec  2 11:15:25 2021
========= Last MCU build config =========
# CONFIG_LOW_LEVEL_OPTIONS is not set
# CONFIG_MACH_AVR is not set
# CONFIG_MACH_ATSAM is not set
# CONFIG_MACH_ATSAMD is not set
CONFIG_MACH_LPC176X=y
# CONFIG_MACH_STM32 is not set
# CONFIG_MACH_RP2040 is not set
# CONFIG_MACH_PRU is not set
# CONFIG_MACH_LINUX is not set
# CONFIG_MACH_SIMU is not set
CONFIG_BOARD_DIRECTORY="lpc176x"
CONFIG_MCU="lpc1768"
CONFIG_CLOCK_FREQ=100000000
CONFIG_USBSERIAL=y
CONFIG_FLASH_START=0x4000
CONFIG_FLASH_SIZE=0x80000
CONFIG_RAM_START=0x10000000
CONFIG_RAM_SIZE=0x7fe0
CONFIG_STACK_SIZE=512
CONFIG_LPC_SELECT=y
CONFIG_MACH_LPC1768=y
# CONFIG_MACH_LPC1769 is not set
CONFIG_SMOOTHIEWARE_BOOTLOADER=y
CONFIG_LPC_USB=y
# CONFIG_LPC_SERIAL_UART0_P03_P02 is not set
CONFIG_USB_VENDOR_ID=0x1d50
CONFIG_USB_DEVICE_ID=0x614e
CONFIG_USB_SERIAL_NUMBER_CHIPID=y
CONFIG_USB_SERIAL_NUMBER="12345"
CONFIG_HAVE_GPIO=y
CONFIG_HAVE_GPIO_ADC=y
CONFIG_HAVE_GPIO_SPI=y
CONFIG_HAVE_GPIO_I2C=y
CONFIG_HAVE_GPIO_HARD_PWM=y
CONFIG_HAVE_GPIO_BITBANGING=y
CONFIG_HAVE_STRICT_TIMING=y
CONFIG_HAVE_CHIPID=y
CONFIG_HAVE_STEPPER_BOTH_EDGE=y
CONFIG_INLINE_STEPPER_HACK=y
=======================
Build file /home/pi/klipper/klippy/../out/klipper.dict(6738): Thu Dec  2 11:15:37 2021
Last MCU build version: v0.10.0-171-g8b2da0d3
Last MCU build tools: gcc: (15:7-2018-q2-6) 7.3.1 20180622 (release) [ARM/embedded-7-branch revision 261907] binutils: (2.31.1-11+rpi1+11) 2.31.1
Last MCU build config: BUS_PINS_i2c1=P0.1,P0.0 BUS_PINS_i2c0=P0.28,P0.27 BUS_PINS_i2c2=P0.11,P0.10 BUS_PINS_i2c1a=P0.20,P0.19 BUS_PINS_ssp1=P0.8,P0.9,P0.7 STEPPER_BOTH_EDGE=1 ADC_MAX=4095 BUS_PINS_ssp0=P0.17,P0.18,P0.15 PWM_MAX=255 CLOCK_FREQ=100000000 RESERVE_PINS_USB=P0.30,P0.29,P2.9 MCU=lpc1768 STATS_SUMSQ_BASE=256
Build file /home/pi/klipper/klippy/../out/klipper.elf(274504): Thu Dec  2 11:15:42 2021
Starting Klippy...
Args: ['/home/pi/klipper/klippy/klippy.py', '/home/pi/klipper_config/printer.cfg', '-l', '/home/pi/klipper_logs/klippy.log', '-a', '/tmp/klippy_uds']
Git version: 'v0.10.0-171-g8b2da0d3'
CPU: 4 core ARMv7 Processor rev 3 (v7l)
Python: '2.7.16 (default, Oct 10 2019, 22:02:15) \n[GCC 8.3.0]'
Start printer at Thu Dec  2 11:20:22 2021 (1638472822.3 2289.6)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro START_PRINT]
gcode = 
	CLEAR_PAUSE
	M117 Print Starting...
	M104 S{T_EXTRUDER}
	M140 S{T_BED}
	{% if printer.heater_bed.temperature < params.T_BED|float*0.95 %}
	M190 S{params.T_BED|float*0.95}
	{% endif %}
	M117 Homing All...
	G28
	G92 E0 ; Reset Extruder distance to 0
	G1 E-2 ; Retracts filament to prevent blobs during probing
	Z_TILT_ADJUST
	LEVEL_BED
	G90
	G92 E0
	SET_GCODE_OFFSET Z=0
	G1 X15 Y20 Z5 F6000
	M117 Waiting for Temps
	M190 S{T_BED}
	M109 S{T_EXTRUDER}
	PRIME_LINE
	M117 Printing.....

[gcode_macro END_PRINT]
gcode = 
	SAVE_GCODE_STATE NAME=end_print
	M117 Done printing
	G91
	G1 E-10 F3600
	G90
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < 100 %}
	{% set z_safe = 100.0 %}
	{% else %}
	{% set z_safe = 0 %}
	{% endif %}
	{% set x_max = printer.toolhead.axis_maximum.x|float - 3 %}
	{% set y_max = printer.toolhead.axis_maximum.y|float - 3 %}
	G1 X{x_max} Y{y_max} Z{z_safe} F2000
	M104 S0         ;Disable Hot End
	M140 S0         ;Disable Heat Bed
	RESTORE_GCODE_STATE NAME=end_print
	M84             ;Disable Steppers
	BED_MESH_CLEAR

[gcode_macro PRIME_LINE]
gcode = 
	M117 Prime Line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up
	G1 X0 Y30 Z2.28 F5000 ;Move to start position
	G1 X0 Y200.0 Z2.28 F500 E15 ;Draw the first line
	G1 X1 Y200.0 Z2.28 F5000 ;Move to side a little
	G1 X1 Y50 Z2.28 F500 E30 ;Draw the second line
	G92 E0 ;Reset Extruder
	G1 Z2.0 F3000 ;Move Z Axis up

[gcode_macro G29]
gcode = 
	G28
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE save=default

[gcode_macro LEVEL_BED]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro M205]
gcode = 
	{% if 'X' in params %}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={ X }
	{% endif %}

[gcode_macro LOW_TEMP_CHECK]
gcode = 
	{% if printer.extruder.target != 0 %}
	{% if printer.extruder.temperature < printer.extruder.target %}
	M117 Heating from {printer.extruder.temperature} to {printer.extruder.target}.
	M109 S{printer.extruder.target|float}
	{% endif %}
	{% else %}
	{% if printer.extruder.target < T %}
	M117 No setpoint, heating to {T}.
	M109 S{T}
	{% endif %}
	{% endif %}

[gcode_macro M600]
gcode = 
	PAUSE_MACRO
	UNLOAD

[gcode_macro M601]
gcode = 
	PAUSE_MACRO

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro PAUSE_MACRO]
gcode = 
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=bed_temp VALUE={printer.heater_bed.target}
	SET_GCODE_VARIABLE MACRO=PAUSE_MACRO VARIABLE=extruder_temp VALUE={printer.extruder.target}
	M117 Parking...
	PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=28800
variable_bed_temp = 0
variable_extruder_temp = 0

[gcode_macro RESUME_MACRO]
gcode = 
	M117 Heating Back Up...
	M140 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M104 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	M190 S{printer["gcode_macro PAUSE_MACRO"].bed_temp}
	M109 S{printer["gcode_macro PAUSE_MACRO"].extruder_temp}
	SET_IDLE_TIMEOUT TIMEOUT=600
	M117  Resuming...
	RESUME

[gcode_macro LOAD]
gcode = 
	SAVE_GCODE_STATE NAME=loading_filament
	M83
	G92 E0.0
	G1 E10 F1000
	G1 E100 F200
	G92 E0.0
	RESTORE_GCODE_STATE NAME=loading_filament

[gcode_macro UNLOAD]
gcode = 
	SAVE_GCODE_STATE NAME=unloading_filament
	G91
	G1 E10 F100
	G92 E0.0
	G1 E-150 F1000
	G92 E0.0
	RESTORE_GCODE_STATE NAME=unloading_filament

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	SDCARD_RESET_FILE
	BASE_CANCEL_PRINT

[gcode_macro TIMELAPSE_TAKE_FRAME]
gcode = 
	{action_call_remote_method("timelapse_newframe")}

[gcode_macro TIMELAPSE_RENDER]
gcode = 
	{action_call_remote_method("timelapse_render")}

[bed_screws]
screw1 = 5,5
screw2 = 165,5
screw3 = 325,5
screw4 = 5,325
screw5 = 165,325
screw6 = 325,325

[screws_tilt_adjust]
screw1 = 60,22
screw1_name = front left screw
screw2 = 205,10
screw2_name = front middle screw
screw3 = 350,25
screw3_name = front right screw
screw4 = 50,325
screw4_name = back left screw
screw5 = 205,325
screw5_name = back middle screw
screw6 = 350,325
screw6_name = back right screw
horizontal_move_z = 10
speed = 120
screw_thread = CW-M3

[bed_mesh]
speed = 120
probe_count = 7,7
horizontal_move_z = 15
algorithm = bicubic
mesh_min = 30,20
mesh_max = 300,300
mesh_pps = 0,0

[probe]
x_offset = 41.5
y_offset = 5.1
pin = P1.25
speed = 20
z_offset = 1.540

[input_shaper]
shaper_freq_x = 52.6
shaper_type_x = 2hump_ei
shaper_freq_y = 44.6
shaper_type_y = 2hump_ei

[virtual_sdcard]
path = ~/gcode_files

[mcu]
serial = /dev/serial/by-id/usb-Klipper_lpc1768_0BA0FF02A99869AFEBF2415EC62000F5-if00
restart_method = command

[mcu rpi]
serial = /tmp/klipper_host_mcu

[adxl345]
cs_pin = rpi:None

[resonance_tester]
accel_chip = adxl345
probe_points = 
	165,165,20

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 90

[temperature_sensor enclosure]
sensor_type = ATC Semitec 104GT-2
sensor_pin = P0.25

[printer]
kinematics = corexy
max_velocity = 300
max_accel = 3000
max_accel_to_decel = 3000
max_z_velocity = 25
max_z_accel = 30

[stepper_x]
step_pin = P2.2
dir_pin = !P2.3
enable_pin = !P2.1
rotation_distance = 40
endstop_pin = !P1.29
position_endstop = -19
position_min = -19
position_max = 311
homing_speed = 50
homing_retract_dist = 10
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_x]
uart_pin = P1.1
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_y]
step_pin = P0.19
dir_pin = P0.20
enable_pin = !P2.8
rotation_distance = 40
endstop_pin = !P1.27
position_endstop = -6
position_min = -6
position_max = 324
homing_retract_dist = 10
homing_speed = 50.0
second_homing_speed = 10.0
microsteps = 16
full_steps_per_rotation = 400

[tmc2209 stepper_y]
uart_pin = P1.8
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z]
step_pin = P1.9
dir_pin = !P1.14
enable_pin = !P0.10
rotation_distance = 8
microsteps = 16
endstop_pin = probe:z_virtual_endstop
position_max = 400
position_min = -10

[safe_z_home]
home_xy_position = 165,165
speed = 50
z_hop = 10
z_hop_speed = 5

[tmc2209 stepper_z]
uart_pin = P1.10
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[stepper_z1]
step_pin = P0.22
dir_pin = !P2.11
enable_pin = !P0.21
rotation_distance = 8
microsteps = 16

[tmc2209 stepper_z1]
uart_pin = P1.17
interpolate = True
run_current = 0.800
hold_current = 0.700
stealthchop_threshold = 9999
sense_resistor = 0.110

[z_tilt]
horizontal_move_z = 15
speed = 180
retries = 5
retry_tolerance = 0.01
z_positions = 
	50,165
	270,165
points = 
	10,165
	260,165

[extruder]
step_pin = P2.13
enable_pin = !P2.12
rotation_distance = 7.75
dir_pin = !P0.11
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin = P2.7
sensor_type = PT1000
sensor_pin = P0.23
control = pid
pid_kp = 24.817
pid_ki = 1.157
pid_kd = 133.080
min_temp = 0
max_temp = 300
microsteps = 16
max_extrude_only_distance = 800.0

[tmc2209 extruder]
uart_pin = P1.15
interpolate = True
run_current = 0.500
hold_current = 0.500
sense_resistor = 0.110
stealthchop_threshold = 9999

[heater_bed]
heater_pin = P2.5
sensor_type = EPCOS 100K B57560G104F
sensor_pin = P0.24
control = pid
pid_kp = 54.027
pid_ki = 0.770
pid_kd = 948.182
min_temp = 0
max_temp = 130

[heater_fan hotend_fan]
pin = P1.4
heater = extruder
heater_temp = 50.0

[fan]
pin = P2.4
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 3041700960: New connection
webhooks client 3041700960: Client info {'program': 'Moonraker', 'version': 'v0.7.1-194-geda5623'}
mcu 'mcu': got {'#receive_time': 2290.119982227, u'next_clock': 2622032704L, u'oid': 17, u'value': 31517, '#name': u'analog_in_state', '#sent_time': 2290.118599579}
mcu 'mcu': got {'#receive_time': 2290.19997256, u'next_clock': 2630032704L, u'oid': 25, u'value': 6159, '#name': u'analog_in_state', '#sent_time': 2290.170071764}
mcu 'mcu': got {'#receive_time': 2290.409975412, u'next_clock': 2651032704L, u'oid': 16, u'value': 31505, '#name': u'analog_in_state', '#sent_time': 2290.37313182}
mcu 'mcu': got {'#receive_time': 2290.419945597, u'next_clock': 2652032704L, u'oid': 17, u'value': 31517, '#name': u'analog_in_state', '#sent_time': 2290.37313182}
mcu 'mcu': got {'#receive_time': 2290.499933931, u'next_clock': 2660032704L, u'oid': 25, u'value': 6157, '#name': u'analog_in_state', '#sent_time': 2290.475275671}
Loaded MCU 'mcu' 94 commands (v0.10.0-171-g8b2da0d3 / gcc: (15:7-2018-q2-6) 7.3.1 20180622 (release) [ARM/embedded-7-branch revision 261907] binutils: (2.31.1-11+rpi1+11) 2.31.1)
MCU 'mcu' config: BUS_PINS_i2c1=P0.1,P0.0 BUS_PINS_i2c0=P0.28,P0.27 BUS_PINS_i2c2=P0.11,P0.10 BUS_PINS_i2c1a=P0.20,P0.19 BUS_PINS_ssp1=P0.8,P0.9,P0.7 STEPPER_BOTH_EDGE=1 ADC_MAX=4095 BUS_PINS_ssp0=P0.17,P0.18,P0.15 PWM_MAX=255 CLOCK_FREQ=100000000 RESERVE_PINS_USB=P0.30,P0.29,P2.9 MCU=lpc1768 STATS_SUMSQ_BASE=256
mcu 'rpi': Starting connect
mcu 'mcu': got {'#receive_time': 2290.709938356, u'next_clock': 2681032704L, u'oid': 16, u'value': 31505, '#name': u'analog_in_state', '#sent_time': 2290.528115616}
mcu 'mcu': got {'#receive_time': 2290.71991656, u'next_clock': 2682032704L, u'oid': 17, u'value': 31516, '#name': u'analog_in_state', '#sent_time': 2290.528115616}
mcu 'mcu': got {'#receive_time': 2290.799989264, u'next_clock': 2690032704L, u'oid': 25, u'value': 6147, '#name': u'analog_in_state', '#sent_time': 2290.528115616}
Loaded MCU 'rpi' 101 commands (v0.10.0-171-g8b2da0d3 / gcc: (Raspbian 8.3.0-6+rpi1) 8.3.0 binutils: (GNU Binutils for Raspbian) 2.31.1)
MCU 'rpi' config: PCA9685_MAX=4096 ADC_MAX=4095 PWM_MAX=32768 CLOCK_FREQ=50000000 MCU=linux STATS_SUMSQ_BASE=256
Configured MCU 'mcu' (1024 moves)
Sending MCU 'rpi' printer configuration...
Configured MCU 'rpi' (1024 moves)
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (-11.5, 14.9)   | (30.0, 20.0)
  1   | (33.5, 14.9)    | (75.0, 20.0)
  2   | (78.5, 14.9)    | (120.0, 20.0)
  3   | (123.5, 14.9)   | (165.0, 20.0)
  4   | (168.5, 14.9)   | (210.0, 20.0)
  5   | (213.5, 14.9)   | (255.0, 20.0)
  6   | (258.5, 14.9)   | (300.0, 20.0)
  7   | (258.5, 61.6)   | (300.0, 66.7)
  8   | (213.5, 61.6)   | (255.0, 66.7)
  9   | (168.5, 61.6)   | (210.0, 66.7)
  10  | (123.5, 61.6)   | (165.0, 66.7)
  11  | (78.5, 61.6)    | (120.0, 66.7)
  12  | (33.5, 61.6)    | (75.0, 66.7)
  13  | (-11.5, 61.6)   | (30.0, 66.7)
  14  | (-11.5, 108.2)  | (30.0, 113.3)
  15  | (33.5, 108.2)   | (75.0, 113.3)
  16  | (78.5, 108.2)   | (120.0, 113.3)
  17  | (123.5, 108.2)  | (165.0, 113.3)
  18  | (168.5, 108.2)  | (210.0, 113.3)
  19  | (213.5, 108.2)  | (255.0, 113.3)
  20  | (258.5, 108.2)  | (300.0, 113.3)
  21  | (258.5, 154.9)  | (300.0, 160.0)
  22  | (213.5, 154.9)  | (255.0, 160.0)
  23  | (168.5, 154.9)  | (210.0, 160.0)
  24  | (123.5, 154.9)  | (165.0, 160.0)
  25  | (78.5, 154.9)   | (120.0, 160.0)
  26  | (33.5, 154.9)   | (75.0, 160.0)
  27  | (-11.5, 154.9)  | (30.0, 160.0)
  28  | (-11.5, 201.5)  | (30.0, 206.6)
  29  | (33.5, 201.5)   | (75.0, 206.6)
  30  | (78.5, 201.5)   | (120.0, 206.6)
  31  | (123.5, 201.5)  | (165.0, 206.6)
  32  | (168.5, 201.5)  | (210.0, 206.6)
  33  | (213.5, 201.5)  | (255.0, 206.6)
  34  | (258.5, 201.5)  | (300.0, 206.6)
  35  | (258.5, 248.2)  | (300.0, 253.3)
  36  | (213.5, 248.2)  | (255.0, 253.3)
  37  | (168.5, 248.2)  | (210.0, 253.3)
  38  | (123.5, 248.2)  | (165.0, 253.3)
  39  | (78.5, 248.2)   | (120.0, 253.3)
  40  | (33.5, 248.2)   | (75.0, 253.3)
  41  | (-11.5, 248.2)  | (30.0, 253.3)
  42  | (-11.5, 294.9)  | (30.0, 300.0)
  43  | (33.5, 294.9)   | (75.0, 300.0)
  44  | (78.5, 294.9)   | (120.0, 300.0)
  45  | (123.5, 294.9)  | (165.0, 300.0)
  46  | (168.5, 294.9)  | (210.0, 300.0)
  47  | (213.5, 294.9)  | (255.0, 300.0)
  48  | (258.5, 294.9)  | (300.0, 300.0)
Starting heater checks for heater_bed
Starting heater checks for extruder
webhooks: registering remote method 'shutdown_machine' for connection id: 3041700960
webhooks: registering remote method 'reboot_machine' for connection id: 3041700960
webhooks: registering remote method 'pause_job_queue' for connection id: 3041700960
webhooks: registering remote method 'start_job_queue' for connection id: 3041700960
