(function(){"use strict";var $=(t=>(t.Clockwise="clockwise",t.CounterClockwise="counter-clockwise",t))($||{}),u=(t=>(t.Relative="relative",t.Absolute="absolute",t))(u||{}),ot=typeof global=="object"&&global&&global.Object===Object&&global,st=ot,ct=typeof self=="object"&&self&&self.Object===Object&&self,ut=st||ct||Function("return this")(),T=ut,lt=T.Symbol,h=lt,j=Object.prototype,ft=j.hasOwnProperty,ht=j.toString,b=h?h.toStringTag:void 0;function pt(t){var e=ft.call(t,b),r=t[b];try{t[b]=void 0;var n=!0}catch{}var a=ht.call(t);return n&&(e?t[b]=r:delete t[b]),a}var dt=Object.prototype,gt=dt.toString;function vt(t){return gt.call(t)}var yt="[object Null]",_t="[object Undefined]",R=h?h.toStringTag:void 0;function C(t){return t==null?t===void 0?_t:yt:R&&R in Object(t)?pt(t):vt(t)}function A(t){return t!=null&&typeof t=="object"}var bt="[object Symbol]";function I(t){return typeof t=="symbol"||A(t)&&C(t)==bt}function mt(t,e){for(var r=-1,n=t==null?0:t.length,a=Array(n);++r<n;)a[r]=e(t[r],r,t);return a}var xt=Array.isArray,m=xt,wt=1/0,D=h?h.prototype:void 0,H=D?D.toString:void 0;function U(t){if(typeof t=="string")return t;if(m(t))return mt(t,U)+"";if(I(t))return H?H.call(t):"";var e=t+"";return e=="0"&&1/t==-wt?"-0":e}function w(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Pt(t){return t}var Ot="[object AsyncFunction]",St="[object Function]",zt="[object GeneratorFunction]",$t="[object Proxy]";function Tt(t){if(!w(t))return!1;var e=C(t);return e==St||e==zt||e==Ot||e==$t}var Ct=T["__core-js_shared__"],E=Ct,L=function(){var t=/[^.]+$/.exec(E&&E.keys&&E.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function At(t){return!!L&&L in t}var It=Function.prototype,Et=It.toString;function Mt(t){if(t!=null){try{return Et.call(t)}catch{}try{return t+""}catch{}}return""}var Gt=/[\\^$.*+?()[\]{}|]/g,Nt=/^\[object .+?Constructor\]$/,Ft=Function.prototype,jt=Object.prototype,Rt=Ft.toString,Dt=jt.hasOwnProperty,Ht=RegExp("^"+Rt.call(Dt).replace(Gt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ut(t){if(!w(t)||At(t))return!1;var e=Tt(t)?Ht:Nt;return e.test(Mt(t))}function Lt(t,e){return t==null?void 0:t[e]}function M(t,e){var r=Lt(t,e);return Ut(r)?r:void 0}function Kt(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var Xt=800,kt=16,Jt=Date.now;function Yt(t){var e=0,r=0;return function(){var n=Jt(),a=kt-(n-r);if(r=n,a>0){if(++e>=Xt)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Zt(t){return function(){return t}}var qt=function(){try{var t=M(Object,"defineProperty");return t({},"",{}),t}catch{}}(),P=qt,Bt=P?function(t,e){return P(t,"toString",{configurable:!0,enumerable:!1,value:Zt(e),writable:!0})}:Pt,Qt=Bt,Wt=Yt(Qt),Vt=Wt,te=9007199254740991,ee=/^(?:0|[1-9]\d*)$/;function K(t,e){var r=typeof t;return e=e==null?te:e,!!e&&(r=="number"||r!="symbol"&&ee.test(t))&&t>-1&&t%1==0&&t<e}function re(t,e,r){e=="__proto__"&&P?P(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function X(t,e){return t===e||t!==t&&e!==e}var ne=Object.prototype,ae=ne.hasOwnProperty;function ie(t,e,r){var n=t[e];(!(ae.call(t,e)&&X(n,r))||r===void 0&&!(e in t))&&re(t,e,r)}var k=Math.max;function oe(t,e,r){return e=k(e===void 0?t.length-1:e,0),function(){for(var n=arguments,a=-1,s=k(n.length-e,0),i=Array(s);++a<s;)i[a]=n[e+a];a=-1;for(var o=Array(e+1);++a<e;)o[a]=n[a];return o[e]=r(i),Kt(t,this,o)}}var se=9007199254740991;function ce(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=se}var ue="[object Arguments]";function J(t){return A(t)&&C(t)==ue}var Y=Object.prototype,le=Y.hasOwnProperty,fe=Y.propertyIsEnumerable,he=J(function(){return arguments}())?J:function(t){return A(t)&&le.call(t,"callee")&&!fe.call(t,"callee")},Z=he,pe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,de=/^\w*$/;function ge(t,e){if(m(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||I(t)?!0:de.test(t)||!pe.test(t)||e!=null&&t in Object(e)}var ve=M(Object,"create"),x=ve;function ye(){this.__data__=x?x(null):{},this.size=0}function _e(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var be="__lodash_hash_undefined__",me=Object.prototype,xe=me.hasOwnProperty;function we(t){var e=this.__data__;if(x){var r=e[t];return r===be?void 0:r}return xe.call(e,t)?e[t]:void 0}var Pe=Object.prototype,Oe=Pe.hasOwnProperty;function Se(t){var e=this.__data__;return x?e[t]!==void 0:Oe.call(e,t)}var ze="__lodash_hash_undefined__";function $e(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=x&&e===void 0?ze:e,this}function p(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}p.prototype.clear=ye,p.prototype.delete=_e,p.prototype.get=we,p.prototype.has=Se,p.prototype.set=$e;function Te(){this.__data__=[],this.size=0}function O(t,e){for(var r=t.length;r--;)if(X(t[r][0],e))return r;return-1}var Ce=Array.prototype,Ae=Ce.splice;function Ie(t){var e=this.__data__,r=O(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Ae.call(e,r,1),--this.size,!0}function Ee(t){var e=this.__data__,r=O(e,t);return r<0?void 0:e[r][1]}function Me(t){return O(this.__data__,t)>-1}function Ge(t,e){var r=this.__data__,n=O(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function v(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}v.prototype.clear=Te,v.prototype.delete=Ie,v.prototype.get=Ee,v.prototype.has=Me,v.prototype.set=Ge;var Ne=M(T,"Map"),Fe=Ne;function je(){this.size=0,this.__data__={hash:new p,map:new(Fe||v),string:new p}}function Re(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function S(t,e){var r=t.__data__;return Re(e)?r[typeof e=="string"?"string":"hash"]:r.map}function De(t){var e=S(this,t).delete(t);return this.size-=e?1:0,e}function He(t){return S(this,t).get(t)}function Ue(t){return S(this,t).has(t)}function Le(t,e){var r=S(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function d(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}d.prototype.clear=je,d.prototype.delete=De,d.prototype.get=He,d.prototype.has=Ue,d.prototype.set=Le;var Ke="Expected a function";function G(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Ke);var r=function(){var n=arguments,a=e?e.apply(this,n):n[0],s=r.cache;if(s.has(a))return s.get(a);var i=t.apply(this,n);return r.cache=s.set(a,i)||s,i};return r.cache=new(G.Cache||d),r}G.Cache=d;var Xe=500;function ke(t){var e=G(t,function(n){return r.size===Xe&&r.clear(),n}),r=e.cache;return e}var Je=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ye=/\\(\\)?/g,Ze=ke(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Je,function(r,n,a,s){e.push(a?s.replace(Ye,"$1"):n||r)}),e}),qe=Ze;function Be(t){return t==null?"":U(t)}function z(t,e){return m(t)?t:ge(t,e)?[t]:qe(Be(t))}var Qe=1/0;function N(t){if(typeof t=="string"||I(t))return t;var e=t+"";return e=="0"&&1/t==-Qe?"-0":e}function We(t,e){e=z(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[N(e[r++])];return r&&r==n?t:void 0}function Ve(t,e){for(var r=-1,n=e.length,a=t.length;++r<n;)t[a+r]=e[r];return t}var q=h?h.isConcatSpreadable:void 0;function tr(t){return m(t)||Z(t)||!!(q&&t&&t[q])}function B(t,e,r,n,a){var s=-1,i=t.length;for(r||(r=tr),a||(a=[]);++s<i;){var o=t[s];e>0&&r(o)?e>1?B(o,e-1,r,n,a):Ve(a,o):n||(a[a.length]=o)}return a}function er(t){var e=t==null?0:t.length;return e?B(t,1):[]}function rr(t){return Vt(oe(t,void 0,er),t+"")}function nr(t,e){return t!=null&&e in Object(t)}function ar(t,e,r){e=z(e,t);for(var n=-1,a=e.length,s=!1;++n<a;){var i=N(e[n]);if(!(s=t!=null&&r(t,i)))break;t=t[i]}return s||++n!=a?s:(a=t==null?0:t.length,!!a&&ce(a)&&K(i,a)&&(m(t)||Z(t)))}function ir(t,e){return t!=null&&ar(t,e,nr)}function or(t,e,r,n){if(!w(t))return t;e=z(e,t);for(var a=-1,s=e.length,i=s-1,o=t;o!=null&&++a<s;){var l=N(e[a]),g=r;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(a!=i){var y=o[l];g=n?n(y,l,o):void 0,g===void 0&&(g=w(y)?y:K(e[a+1])?[]:{})}ie(o,l,g),o=o[l]}return t}function sr(t,e,r){for(var n=-1,a=e.length,s={};++n<a;){var i=e[n],o=We(t,i);r(o,i)&&or(s,z(i,t),o)}return s}function cr(t,e){return sr(t,e,function(r,n){return ir(t,n)})}var ur=rr(function(t,e){return t==null?{}:cr(t,e)}),Q=ur;function lr(t){const[,e,r=""]=t.trim().split(";",2)[0].split(/^([a-z][0-9]+)\s+/i);if(!/^(G|M)\d+$/.test(e))return null;const n={};for(const[,a,s]of r.matchAll(/([a-z])[ \t]*(-?(?:\d+(?:\.\d+)?|\.\d+))/ig))n[a.toLowerCase()]=Number(s);return{command:e.toUpperCase(),args:n}}function fr(t,e){var l,g,y,W,V,tt,et,rt,nt,at,it;const r=[],n=t.split(`
`);let a=u.Relative,s=u.Absolute;const i={x:0,y:0,z:0,e:0,filePosition:0},o={length:1,extrudeExtra:0,z:0};for(let _=0;_<n.length;_++){const{command:F,args:f}=(l=lr(n[_]))!=null?l:{};if(!F){i.filePosition+=n[_].length+1;continue}let c=null;switch(F){case"G0":case"G1":c=Q(f,["x","y","z","e"]);break;case"G2":case"G3":c={...Q(f,["x","y","z","e","i","j","r"]),direction:F==="G2"?$.Clockwise:$.CounterClockwise};break;case"G10":c={e:-o.length},o.z!==0&&(c.z=i.z+o.z);break;case"G11":c={e:o.length+o.extrudeExtra},o.z!==0&&(c.z=i.z-o.z);break;case"G90":s=u.Absolute;case"M82":a=u.Absolute,i.e=0;break;case"G91":s=u.Relative;case"M83":a=u.Relative;break;case"G92":a===u.Absolute&&(i.e=(g=f.e)!=null?g:i.e),s===u.Absolute&&(i.x=(y=f.x)!=null?y:i.x,i.y=(W=f.y)!=null?W:i.y,i.z=(V=f.z)!=null?V:i.z);break;case"M207":o.length=(tt=f.s)!=null?tt:o.length,o.extrudeExtra=(et=f.s)!=null?et:o.extrudeExtra,o.z=(rt=f.z)!=null?rt:o.z;break}if(c){if(a===u.Absolute&&c.e!==void 0){const dr=c.e-i.e;i.e=c.e,c.e=dr}s===u.Relative&&(c.x!==void 0&&(c.x+=i.x),c.y!==void 0&&(c.y+=i.y),c.z!==void 0&&(c.z+=i.z)),i.x=(nt=c.x)!=null?nt:i.x,i.y=(at=c.y)!=null?at:i.y,i.z=(it=c.z)!=null?it:i.z,c.filePosition=i.filePosition,r.push(Object.freeze(c))}_%Math.floor(n.length/100)===0&&e(i.filePosition),i.filePosition+=n[_].length+1}return e(i.filePosition),r}const hr=t=>{const e={action:"progress",filePosition:t};self.postMessage(e)},pr=t=>{const e={action:"moves",moves:t};self.postMessage(e)};self.onmessage=t=>{const e=t.data;switch(e.action){case"parse":{const r=fr(e.gcode,hr);pr(r);break}}}})();
